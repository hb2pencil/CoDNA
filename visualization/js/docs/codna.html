<!DOCTYPE html>

<html>
<head>
  <title>codna.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>codna.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>CoDNA 0.1.0
(c) 2013 Henry Brausen, David Turner
https://github.com/hb2pencil/CoDNA
Released under GPLv2 License</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>(window, document, <span class="literal">undefined</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Article</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>Article = Backbone.Model.extend({

    initialize: <span class="keyword">function</span>(){
    
    },
    
    urlRoot: <span class="string">""</span>,
    
    defaults: {
        title: <span class="string">""</span>,
        rev_count: <span class="number">0</span>,
        set: <span class="number">1</span>,
        display: <span class="literal">true</span>
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>ArticleCollection</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>ArticleCollection = Backbone.Collection.extend({
    
    model: Article,
    
    url: <span class="keyword">function</span>(){
        <span class="keyword">return</span> <span class="string">"dbquery.php?list"</span>;
    }
    
});</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2>ArticleSet</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>ArticleSet = Backbone.Model.extend({

    initialize: <span class="keyword">function</span>(){
    
    },
    
    urlRoot: <span class="string">""</span>,
    
    defaults: {
        id: <span class="literal">null</span>,
        name: <span class="string">""</span>,
        url: <span class="string">""</span>,
        count: <span class="number">0</span>
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2>ArticleSetCollection</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>ArticleSetCollection = Backbone.Collection.extend({
    
    model: ArticleSet,
    
    url: <span class="string">"dbquery.php?listArticleSets"</span>
    
});</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2>TopTab</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>TopTab = Backbone.Model.extend({

    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.on(<span class="string">'change:selected'</span>, <span class="keyword">function</span>(){
            <span class="keyword">if</span>(topTabs.getSelected() == <span class="keyword">this</span>){
                $(<span class="string">"#content"</span>).html(<span class="keyword">this</span>.content);
            }
            <span class="keyword">else</span>{
                <span class="keyword">this</span>.content = <span class="keyword">this</span>.get(<span class="string">'mainView'</span>).$el.detach();
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Close any dialogs which are open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">".ui-dialog-content"</span>).dialog(<span class="string">'close'</span>);
        }, <span class="keyword">this</span>);
        <span class="keyword">this</span>.get(<span class="string">'mainView'</span>).render();
    },
    
    defaults: {
        type: <span class="string">"tab"</span>,
        color: <span class="string">"#CFECAD"</span>,
        hoverColor: <span class="string">"#BDD99E"</span>,
        title: <span class="string">""</span>,
        selected: <span class="literal">false</span>,
        x: Number.MAX_VALUE/<span class="number">2</span>,
        mainView: <span class="literal">null</span>
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2>NewTopTab</h2>
<p>(used for a &quot;+&quot; button to create a new tab)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>NewTopTab = TopTab.extend({

    initialize: <span class="keyword">function</span>(){
        
    },
    
    defaults: {
        type: <span class="string">"new"</span>,
        color: <span class="string">"#EEEEEE"</span>,
        hoverColor: <span class="string">"#DDDDDD"</span>,
        title: <span class="string">"&lt;b&gt;&amp;#10133;&lt;/b&gt;"</span>,
        selected: <span class="literal">false</span>,
        x: Number.MAX_VALUE,
        mainView: <span class="literal">null</span>,
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2>TopTabCollection</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>TopTabCollection = Backbone.Collection.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Comparator is the x coordinate of the tab.
Tabs of type &#39;new&#39; should be treates specially, and always be at the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    comparator: <span class="keyword">function</span>(tab){
        <span class="keyword">if</span>(tab.get(<span class="string">'type'</span>) == <span class="string">'new'</span>){
            <span class="keyword">return</span> Number.MAX_VALUE;
        }
        <span class="keyword">return</span> tab.get(<span class="string">'x'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Returns the currently selected tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getSelected: <span class="keyword">function</span>(){
        <span class="keyword">return</span> <span class="keyword">this</span>.findWhere({<span class="string">'selected'</span>: <span class="literal">true</span>});
    },
    
    model: TopTab
    
});</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h2>User</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>User = Backbone.Model.extend({

    initialize: <span class="keyword">function</span>(){

    },
    
    urlRoot: <span class="keyword">function</span>(){
        <span class="keyword">return</span> <span class="string">"dbquery.php?users&amp;id="</span> + <span class="keyword">this</span>.get(<span class="string">'id'</span>);
    },
    
    defaults: {
        id: <span class="number">0</span>,
        name: <span class="string">""</span>,
        histid: <span class="string">""</span>,
        flagged: <span class="number">0</span>,
        edits: <span class="number">0</span>,
        created: <span class="string">""</span>,
        display: <span class="literal">true</span>
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2>UserCollection</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>UserCollection = Backbone.Collection.extend({

    model: User,
    
    url: <span class="string">"dbquery.php?users"</span>

});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2>UserSet</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>UserSet = Backbone.Model.extend({

    initialize: <span class="keyword">function</span>(){
    
    },
    
    urlRoot: <span class="string">""</span>,
    
    defaults: {
        id: <span class="literal">null</span>,
        name: <span class="string">""</span>,
        url: <span class="string">""</span>,
        count: <span class="number">0</span>
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2>UserSetCollection</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>UserSetCollection = Backbone.Collection.extend({
    
    model: UserSet,
    
    url: <span class="string">"dbquery.php?listUserSets"</span>
    
});</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2>WikiViz</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>WikiViz = Backbone.Model.extend({

    initialize: <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Create a fetch a new WikiVizData</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> data = <span class="literal">null</span>;
        <span class="keyword">if</span>(<span class="keyword">this</span>.get(<span class="string">'user'</span>) != <span class="string">""</span>){
            data = <span class="keyword">new</span> WikiVizData({user: <span class="keyword">this</span>.get(<span class="string">'user'</span>), wikiviz: <span class="keyword">this</span>});
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.get(<span class="string">'title'</span>) != <span class="string">""</span>){
            data = <span class="keyword">new</span> WikiVizData({title: <span class="keyword">this</span>.get(<span class="string">'title'</span>), wikiviz: <span class="keyword">this</span>});
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>The weights for computing the weighted-splitting of visualization bars.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.set(<span class="string">'weights'</span>, {
            add: <span class="number">60</span>,
            remove: <span class="number">60</span>,
            edit: <span class="number">20</span>,
            reorganize: <span class="number">40</span>,
            vand: <span class="number">10</span>,
            unvand: <span class="number">10</span>,
            cite: <span class="number">20</span>,
            unclassified: <span class="number">60</span>
        });
        <span class="keyword">this</span>.set(<span class="string">'view'</span>, {});
        data.fetch();
        <span class="keyword">this</span>.set(<span class="string">'data'</span>, data);
        <span class="keyword">this</span>.on(<span class="string">"change:numDots"</span>, <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Make sure numDots is at least 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">this</span>.set(<span class="string">'numDots'</span>, Math.max(<span class="number">1</span>, <span class="keyword">this</span>.get(<span class="string">'numDots'</span>)));
        });
        <span class="keyword">this</span>.on(<span class="string">"change:numBars"</span>, <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Make sure numBars is at least 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">this</span>.set(<span class="string">'numBars'</span>, Math.max(<span class="number">1</span>, <span class="keyword">this</span>.get(<span class="string">'numBars'</span>)));
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Get a list of the user&#39;s groups (&#39;higher-level groups&#39;) at the present time.
So far, this will always return one group, but we can expand on this later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getGroupsByName: <span class="keyword">function</span>(username) {
        <span class="keyword">var</span> users = <span class="keyword">this</span>.get(<span class="string">'data'</span>).get(<span class="string">'users'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>If we don&#39;t have data for this user (for whatever reason), assume no groups.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span>(!users.hasOwnProperty(username)) <span class="keyword">return</span> [<span class="string">'None'</span>];
        <span class="keyword">if</span>(!users[username].history[users[username].history.length-<span class="number">1</span>]) <span class="keyword">return</span> [<span class="string">'None'</span>];
        <span class="keyword">return</span> users[username].history[users[username].history.length-<span class="number">1</span>].userclass;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Get index of element in revision data, or -1 if it doesn&#39;t exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    index: <span class="keyword">function</span>(d){
        <span class="keyword">return</span> d.id;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Get index of element in talk page data, or -1 if it doesn&#39;t exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tIndex: <span class="keyword">function</span>(d){
        <span class="keyword">return</span> d.id;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Determine the higher-level group that a given article-revision belongs to.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getRevisionGroup: <span class="keyword">function</span>(rev){</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>First, grab a list of our users.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> users = <span class="keyword">this</span>.get(<span class="string">'data'</span>).get(<span class="string">'users'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>If the user is unknown, assume that the user is annonymous.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (!rev.user <span class="keyword">in</span> users) <span class="keyword">return</span> <span class="string">'Anon'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Otherwise, we look up out user.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> user = users[rev.user];</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If we encountered an error reading the user, assume anon.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (!user) <span class="keyword">return</span> <span class="string">'Anon'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>If the user is flagged, use result of most recent permission query throughout!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (user.flagged) {
            <span class="keyword">return</span> user.history[user.history.length-<span class="number">1</span>].userclass;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If user has empty history array, assume anon.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (user.history.length &lt; <span class="number">1</span>) { <span class="keyword">return</span> <span class="string">'Anon'</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Find closest user permissions entry without going over the revision date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> revDate = <span class="keyword">new</span> Date(rev.timestamp);
    
        <span class="keyword">var</span> i = <span class="number">1</span>;
    
        <span class="keyword">var</span> lastEntry = user.history[<span class="number">0</span>];
    
        <span class="keyword">while</span>(i &lt; user.history.length) {
            <span class="keyword">if</span> (<span class="keyword">new</span> Date(user.history[i].timestamp) &gt; revDate) <span class="keyword">break</span>;
            lastEntry = user.history[i];
            ++i;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>lastEntry now contains the relevant permission entry.
Return the userclass and we are done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> lastEntry.userclass;
    },
    
    timeX: d3.time.scale(),
    
    defaults: {
        title: <span class="string">""</span>,
        user: <span class="string">""</span>,
        data: <span class="literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Width and height of view area</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        width: <span class="number">910</span>,
        height: <span class="number">500</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Default number of bars / screen to display in adjacent spacing mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        numBars: <span class="number">60</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Width of the mask for the y-axis labels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        maskWidth: <span class="number">50</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>UNUSED: Used to be used for generating &quot;time offset&quot; calues in data annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        timeMultiplier: <span class="number">1</span>,
        isTimeSpaced: <span class="literal">false</span>,
        weights: <span class="literal">null</span>,
        mode: <span class="string">'art'</span>,
        view: <span class="literal">null</span>,
    }

});

WikiVizData = Backbone.Model.extend({
    
    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.on(<span class="string">'sync'</span>, <span class="keyword">this</span>.augment, <span class="keyword">this</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Augment (or annotate) data with useful log(lev) and weighted classification data.
In short, this function generates and attaches additional descriptive data to the data downloaded from the DB.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    augment: <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Useful function to check if a string contain a substring.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="function"><span class="keyword">function</span> <span class="title">strcontains</span><span class="params">(needle, haystack)</span> {</span>
            <span class="keyword">return</span> haystack.indexOf(needle) != -<span class="number">1</span>;
        }
    
        $.each(<span class="keyword">this</span>.get(<span class="string">'talk'</span>), $.proxy(<span class="keyword">function</span>(i, te) {
            te.date = <span class="keyword">new</span> Date(te.timestamp);
            te.loglev = Math.log(te.lev + <span class="number">1</span>);
            te.user = te.contributor;
            te.type = <span class="string">'talk'</span>;
            te.id = i;
            te.group = <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).getRevisionGroup(te);
        }, <span class="keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Loop over each revision, making annotations as necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.each(<span class="keyword">this</span>.get(<span class="string">'revisions'</span>), $.proxy(<span class="keyword">function</span>(i, rev) {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Split up the edit by its classification and the classification weights</p>
<p>Will eventually hold the formatted info for drawing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> wclass = {    
                add: <span class="number">0</span>,
                remove: <span class="number">0</span>,
                edit: <span class="number">0</span>,
                reorganize: <span class="number">0</span>,
                cite: <span class="number">0</span>,
                vand: <span class="number">0</span>,
                unvand: <span class="number">0</span>,
                unsure: <span class="number">0</span>,
                unclassified: <span class="number">0</span>
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Perform a weighted-separation of our article revision edit distance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (strcontains(<span class="string">'a'</span>, rev[<span class="string">'class'</span>])) {
                wclass.edit += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).edit;
            }
            <span class="keyword">if</span> (strcontains(<span class="string">'b'</span>, rev[<span class="string">'class'</span>])) {
                wclass.add += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).add;
            }
            <span class="keyword">if</span> (strcontains(<span class="string">'c'</span>, rev[<span class="string">'class'</span>])) {
                wclass.remove += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).remove;
            }
            <span class="keyword">if</span> (strcontains(<span class="string">'d'</span>, rev[<span class="string">'class'</span>])) {
                wclass.reorganize += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).reorganize;
            }
            <span class="keyword">if</span> (strcontains(<span class="string">'e'</span>, rev[<span class="string">'class'</span>])) {
                wclass.cite += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).cite;
            }
            <span class="keyword">if</span> (strcontains(<span class="string">'f'</span>, rev[<span class="string">'class'</span>])) {
                wclass.vand += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).vand;
            }
            <span class="keyword">if</span> (strcontains(<span class="string">'g'</span>, rev[<span class="string">'class'</span>])) {
                wclass.unvand += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).unvand;
            }
            <span class="keyword">if</span> (strcontains(<span class="string">'x'</span>, rev[<span class="string">'class'</span>])) {
                wclass.unclassified += <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).get(<span class="string">'weights'</span>).unclassified;
            }
        
            <span class="keyword">var</span> wsum = <span class="number">0</span>;
            <span class="keyword">for</span> (c <span class="keyword">in</span> wclass) {
                wsum += wclass[c];
            }
            <span class="keyword">if</span> (wsum != <span class="number">0</span>) {
                <span class="keyword">for</span> (c <span class="keyword">in</span> wclass) {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>NOTE: We NEED the &#39;+&#39; before rev.lev to convert it into a number (from a string!)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    wclass[c] = wclass[c] * Math.log(+rev.lev+<span class="number">1</span>) / wsum;
                }
            }
        
            <span class="keyword">if</span> (wsum === <span class="number">0</span>) {
                wclass.unsure = Math.log(rev.lev + <span class="number">1</span>);
            }
            rev.revid = rev.rev_id;
        
            rev.wclass = wclass;
            rev.loglev = Math.log(+rev.lev + <span class="number">1</span>);
            rev.date = <span class="keyword">new</span> Date(rev.timestamp);</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Add the time-dependent user-class classification</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            rev.group = <span class="keyword">this</span>.get(<span class="string">'wikiviz'</span>).getRevisionGroup(rev);
        
            rev.type=<span class="string">'art'</span>;
        
            rev.id = i;
        }, <span class="keyword">this</span>));
    },
    
    urlRoot: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.get(<span class="string">'title'</span>) != <span class="string">""</span>){
            <span class="keyword">return</span> <span class="string">"dbquery.php?"</span> + <span class="string">"lower=0&amp;upper=10000&amp;article="</span> + encodeURIComponent(<span class="keyword">this</span>.get(<span class="string">'title'</span>));
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.get(<span class="string">'user'</span>) != <span class="string">""</span>){
            <span class="keyword">return</span> <span class="string">"dbquery.php?"</span> + <span class="string">"user="</span> + encodeURIComponent(<span class="keyword">this</span>.get(<span class="string">'user'</span>));
        }
    },
    
    defaults: {
        title: <span class="string">""</span>,
        user: <span class="string">""</span>,
        wikiviz: <span class="literal">null</span>,
        users: [],
        revisions: [],
        quality: [],
        events: []
    }
    
});

ArticleInfoView = Backbone.View.extend({

    initialize: <span class="keyword">function</span>(options){
        <span class="keyword">this</span>.article = options.article;
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"sync"</span>, <span class="keyword">this</span>.render);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>), <span class="string">"sync"</span>, <span class="keyword">this</span>.render);
        <span class="keyword">this</span>.template = _.template($(<span class="string">"#article_info_template"</span>).html());
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(_.extend(<span class="keyword">this</span>.article.toJSON(), <span class="keyword">this</span>.model.toJSON())));
        <span class="keyword">this</span>.$el.attr(<span class="string">'id'</span>, <span class="string">"article_info"</span>);
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2>ArticleView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>ArticleView = Backbone.View.extend({
    
    template: _.template($(<span class="string">"#article_container_template"</span>).html()),
    wikiviz: <span class="literal">null</span>,
    navctl: <span class="literal">null</span>,
    
    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.wikiviz = <span class="keyword">new</span> WikiViz({title: <span class="keyword">this</span>.model.get(<span class="string">'title'</span>)});
        <span class="keyword">var</span> id = _.uniqueId();
        $(<span class="string">"#content"</span>).append(<span class="string">"&lt;div id='"</span> + id + <span class="string">"'&gt;"</span>);
        <span class="keyword">this</span>.$el = $(<span class="string">"#"</span> + id);
        <span class="keyword">this</span>.el = $(<span class="string">"#"</span> + id)[<span class="number">0</span>];
        Backbone.Subviews.add(<span class="keyword">this</span>);
    },
    
    subviewCreators : {
        <span class="string">"article_info"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> ArticleInfoView({model: <span class="keyword">this</span>.wikiviz, article: <span class="keyword">this</span>.model});
        },
        <span class="string">"toolbar"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> ToolbarView({model: {<span class="string">'buttons'</span>: [<span class="string">'select'</span>,<span class="string">'data'</span>,<span class="string">'legend'</span>,<span class="string">'deselect'</span>,<span class="string">'talk'</span>]}, view: <span class="keyword">this</span>});
        }
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(<span class="keyword">this</span>.model.toJSON()));
        <span class="keyword">this</span>.viz = <span class="keyword">new</span> WikiVizView({model: <span class="keyword">this</span>.wikiviz, view: <span class="keyword">this</span>, el: <span class="keyword">this</span>.el});
        <span class="keyword">this</span>.viz.init(<span class="keyword">this</span>.model.get(<span class="string">'title'</span>));
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }
    
});</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h2>DialogView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>DialogView = Backbone.View.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Reference to the jQueryUI Dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dialog: <span class="literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Options object for the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options: <span class="literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Function to be called after the dialog is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onCreate: <span class="keyword">function</span>(){},
    firstRender: <span class="literal">true</span>,

    initialize: <span class="keyword">function</span>(options){
        <span class="keyword">this</span>.template = _.template($(<span class="string">"#"</span> + options.template).html());
        <span class="keyword">this</span>.options = options.options;
        <span class="keyword">if</span>(_.isFunction(options.onCreate)){
            <span class="keyword">this</span>.onCreate = options.onCreate;
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Displays the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    open: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.dialog.dialog(<span class="string">'open'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Closes the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    close: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.dialog.dialog(<span class="string">'close'</span>);
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.firstRender){
            <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template());  
            <span class="keyword">this</span>.dialog = <span class="keyword">this</span>.$el.children().dialog(<span class="keyword">this</span>.options);
            <span class="keyword">this</span>.onCreate(<span class="keyword">this</span>.dialog);
        }
        <span class="keyword">this</span>.firstRender = <span class="literal">false</span>;
        <span class="keyword">return</span> <span class="keyword">this</span>.$el; 
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2>NavCtlView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>NavCtlView = Backbone.View.extend({

    article: <span class="literal">null</span>,

    initialize: <span class="keyword">function</span>(options){
        <span class="keyword">this</span>.viz = options.viz;
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.viz.model, <span class="string">"change:mode"</span>, <span class="keyword">this</span>.changeMode);
        $(window).resize($.proxy(<span class="keyword">function</span>(){
            <span class="keyword">if</span>(<span class="keyword">this</span>.viz.$(<span class="string">"#navctl"</span>).width() &gt; <span class="number">0</span>){
                <span class="keyword">this</span>.init(<span class="keyword">this</span>.viz.$(<span class="string">"#navctl"</span>).width(), <span class="keyword">this</span>.dim.h);
            }
        }, <span class="keyword">this</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Adjust the slider when we switch to time-spaced mode.
Use a new time-spaced scale for display.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toTimeSpaced: <span class="keyword">function</span>() {
    
        <span class="keyword">var</span> minDate = _.first(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date;
    
        <span class="keyword">this</span>.xscale = d3.time.scale();</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Todo: domain of talk entries may exceed revisions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.xscale.domain([<span class="keyword">new</span> Date(minDate.getFullYear(), minDate.getMonth()),
            _.last(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date]);
        <span class="keyword">this</span>.xscale.rangeRound([<span class="number">0</span>, <span class="keyword">this</span>.dim.w - <span class="number">2</span>*<span class="keyword">this</span>.handleWidth]);
    
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
    
        <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'rect.sd'</span>).data(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>))
            .attr(<span class="string">'x'</span>, <span class="keyword">function</span>(d,i) { <span class="keyword">return</span> that.xscale(d.date); })
            .attr(<span class="string">'y'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> -that.yscale(d.wclass.remove + d.wclass.vand); })
            .attr(<span class="string">'width'</span>, <span class="keyword">function</span>(d,i) { <span class="keyword">return</span> that.spikewidth; })
            .attr(<span class="string">'height'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> that.yscale(d.loglev - (d.wclass.remove + d.wclass.vand))+that.yscale(d.wclass.remove + d.wclass.vand); })
            .attr(<span class="string">'class'</span>, <span class="string">'sd'</span>);
        
        <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'circle.tcircle'</span>).data(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>))
            .attr(<span class="string">'cx'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> that.xscale(d.date); });
    
        <span class="keyword">this</span>.onSlide();
        <span class="keyword">this</span>.onScale();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>When we switch to adjacent-spaced mode, switch back to using a linear scale for display.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toAdjacentSpaced: <span class="keyword">function</span>() {
        <span class="keyword">this</span>.xscale = d3.scale.linear();
        <span class="keyword">if</span> (<span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'talk'</span>)
            <span class="keyword">this</span>.xscale.domain([<span class="number">0</span>, <span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>).length-<span class="number">1</span>]);
        <span class="keyword">else</span>
            <span class="keyword">this</span>.xscale.domain([<span class="number">0</span>, <span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length-<span class="number">1</span>]);
        
        <span class="keyword">this</span>.xscale.rangeRound([<span class="number">0</span>, <span class="keyword">this</span>.dim.w - <span class="number">2</span>*<span class="keyword">this</span>.handleWidth]);
    
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
    
        <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'rect.sd'</span>).data(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>))
            .attr(<span class="string">'x'</span>, <span class="keyword">function</span>(d,i) { <span class="keyword">return</span> that.xscale(i); })
            .attr(<span class="string">'y'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> -that.yscale(d.wclass.remove + d.wclass.vand); })
            .attr(<span class="string">'width'</span>, <span class="keyword">function</span>(d,i) { <span class="keyword">return</span> that.spikewidth; })
            .attr(<span class="string">'height'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> that.yscale(d.loglev - (d.wclass.remove + d.wclass.vand))+that.yscale(d.wclass.remove + d.wclass.vand); })
            .attr(<span class="string">'class'</span>, <span class="string">'sd'</span>);
        
        <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'circle'</span>).data(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>))
            .attr(<span class="string">'cx'</span>, <span class="keyword">function</span>(d, i) { <span class="keyword">return</span> that.xscale(i); });
    
        <span class="keyword">this</span>.onSlide();
        <span class="keyword">this</span>.onScale();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Change the apperance of the navctl based on the current mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    changeMode: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'art'</span>){
            <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'.sd'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'circle.tcircle'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'talk'</span>){
            <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'.sd'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
            <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'.tcircle'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'hybrid'</span>){
            <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'.sd'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'.tcircle'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        }
        <span class="keyword">this</span>.onScale();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Slide the view when we slide the slider.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onSlide: <span class="keyword">function</span>() {
        d3.select(<span class="keyword">this</span>.viz.$(<span class="string">'g.body'</span>)[<span class="number">0</span>]).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + -Math.round(<span class="keyword">this</span>.getPanOffset()) + <span class="string">',0)'</span>);
        <span class="keyword">this</span>.viz.repositionBar();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Increase/Decrease the range of the chart</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onScale: <span class="keyword">function</span>() {
        <span class="keyword">if</span> (!<span class="keyword">this</span>.viz.model.get(<span class="string">'isTimeSpaced'</span>) &amp;&amp; <span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'art'</span>) {
            <span class="keyword">this</span>.viz.model.set(<span class="string">'numBars'</span>, <span class="keyword">this</span>.getNumBars());
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">this</span>.viz.model.get(<span class="string">'isTimeSpaced'</span>) &amp;&amp; <span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'talk'</span>) {
            <span class="keyword">this</span>.viz.model.set(<span class="string">'numDots'</span>, <span class="keyword">this</span>.getNumBars());
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.viz.model.get(<span class="string">'isTimeSpaced'</span>)) {
            <span class="keyword">var</span> df = _.last(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date;
            <span class="keyword">var</span> d0 = _.first(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date;
            <span class="keyword">var</span> d1 = <span class="keyword">this</span>.xscale.invert(<span class="keyword">this</span>.sdim.x0);
            <span class="keyword">var</span> d2 = <span class="keyword">this</span>.xscale.invert(<span class="keyword">this</span>.sdim.x0+<span class="keyword">this</span>.sdim.w-<span class="keyword">this</span>.handleWidth);</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>The multiplier 0.9 is a quick fix for getting the rightmost bars in TS mode visible.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">this</span>.viz.model.timeX.rangeRound([<span class="number">0</span>, <span class="number">0.9</span>*<span class="keyword">this</span>.viz.model.get(<span class="string">'width'</span>) * (df-d0) / (d2 - d1)]);
            <span class="keyword">this</span>.viz.toTimeSpaced();
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Map slider motion to an offset by which to pan the main view. Behaves differently for time and adjacent spaced modes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getPanOffset: <span class="keyword">function</span>() {
        <span class="keyword">try</span>{
            <span class="keyword">if</span> (!<span class="keyword">this</span>.viz.model.get(<span class="string">'isTimeSpaced'</span>) &amp;&amp; <span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'art'</span>) {
                <span class="keyword">return</span> ((<span class="keyword">this</span>.sdim.x0) / (<span class="keyword">this</span>.dim.w - <span class="number">2</span>*<span class="keyword">this</span>.handleWidth))*(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length*<span class="keyword">this</span>.viz.calcBarWidth());
            }
            <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">this</span>.viz.model.get(<span class="string">'isTimeSpaced'</span>) &amp;&amp; <span class="keyword">this</span>.viz.model.get(<span class="string">'mode'</span>) == <span class="string">'talk'</span>) {
                <span class="keyword">return</span> ((<span class="keyword">this</span>.sdim.x0) / (<span class="keyword">this</span>.dim.w - <span class="number">2</span>*<span class="keyword">this</span>.handleWidth))*(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>).length*<span class="keyword">this</span>.viz.calcTalkWidth());
            }
            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.viz.model.get(<span class="string">'isTimeSpaced'</span>)) {
                <span class="keyword">return</span> <span class="keyword">this</span>.viz.model.timeX(<span class="keyword">this</span>.xscale.invert(<span class="keyword">this</span>.sdim.x0));
            }
        }
        <span class="keyword">catch</span>(e){}
        <span class="keyword">return</span> <span class="number">0</span>;
    },

    getNumBars: <span class="keyword">function</span>() {
        <span class="keyword">return</span> <span class="keyword">this</span>.xscale.invert(<span class="keyword">this</span>.sdim.x0+<span class="keyword">this</span>.sdim.w-<span class="keyword">this</span>.handleWidth) - <span class="keyword">this</span>.xscale.invert(<span class="keyword">this</span>.sdim.x0);
    },

    getTimeRange: <span class="keyword">function</span>() {
    
    },
    
    init: <span class="keyword">function</span>(sw, sh) {
        <span class="keyword">this</span>.viz.$(<span class="string">'#navctl'</span>).empty();</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Scrollbar dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.dim = {w: sw, h: sh};
    
        <span class="keyword">this</span>.sdim = {x0: <span class="number">0</span>, w: <span class="number">100</span>};</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Create the SVG element for the scrollbar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.svg = d3.select(<span class="keyword">this</span>.viz.$(<span class="string">'#navctl'</span>)[<span class="number">0</span>]).append(<span class="string">'svg'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.dim.w).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.dim.h);
        <span class="keyword">this</span>.svg.attr(<span class="string">"viewBox"</span>, <span class="string">"0 0 "</span> + sw + <span class="string">" "</span> + sh);</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Make a background layer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.bg = <span class="keyword">this</span>.svg.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'bg'</span>);
        <span class="keyword">var</span> handleWidth = <span class="keyword">this</span>.dim.h/<span class="number">2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Create handles (semi-circles)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.bg.append(<span class="string">'path'</span>).attr(<span class="string">'d'</span>,<span class="string">'M'</span> + handleWidth + <span class="string">',0 A'</span> + handleWidth + <span class="string">','</span> + handleWidth + <span class="string">' 0 0,0 '</span> + handleWidth + <span class="string">','</span> + handleWidth * <span class="number">2</span> ).attr(<span class="string">'class'</span>, <span class="string">'pad'</span>).attr(<span class="string">'width'</span>, handleWidth).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.dim.h);
        <span class="keyword">this</span>.bg.append(<span class="string">'path'</span>).attr(<span class="string">'d'</span>,<span class="string">'M0,0 A'</span> + handleWidth + <span class="string">','</span> + handleWidth + <span class="string">' 0 0,1 0,'</span> + handleWidth * <span class="number">2</span>).attr(<span class="string">'class'</span>, <span class="string">'pad'</span>).attr(<span class="string">'width'</span>, handleWidth).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.dim.h).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span>+ (<span class="keyword">this</span>.dim.w - handleWidth) + <span class="string">',0)'</span>);
    
        <span class="keyword">this</span>.bg.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'navbars'</span>).attr(<span class="string">'x'</span>, handleWidth).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + handleWidth + <span class="string">','</span> + <span class="keyword">this</span>.dim.h / <span class="number">2</span> + <span class="string">')scale(1,-1)'</span>);
    
        <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).append(<span class="string">'line'</span>)
            .attr(<span class="string">'x1'</span>, <span class="number">0</span>)
            .attr(<span class="string">'y1'</span>, <span class="number">0</span>)
            .attr(<span class="string">'x2'</span>, <span class="keyword">this</span>.dim.w-<span class="number">2</span>*handleWidth)
            .attr(<span class="string">'y2'</span>, <span class="number">0</span>);

        <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).append(<span class="string">'line'</span>)
            .attr(<span class="string">'class'</span>,<span class="string">'navctlborder'</span>)
            .attr(<span class="string">'x1'</span>, <span class="number">0</span>)
            .attr(<span class="string">'y1'</span>, handleWidth)
            .attr(<span class="string">'x2'</span>, <span class="keyword">this</span>.dim.w-<span class="number">2</span>*handleWidth)
            .attr(<span class="string">'y2'</span>, handleWidth);

        <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).append(<span class="string">'line'</span>)
            .attr(<span class="string">'class'</span>,<span class="string">'navctlborder'</span>)
            .attr(<span class="string">'x1'</span>, <span class="number">0</span>)
            .attr(<span class="string">'y1'</span>, -handleWidth)
            .attr(<span class="string">'x2'</span>, <span class="keyword">this</span>.dim.w-<span class="number">2</span>*handleWidth)
            .attr(<span class="string">'y2'</span>, -handleWidth);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Slider group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.slider = <span class="keyword">this</span>.svg.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'slider'</span>);
        <span class="keyword">this</span>.slider.append(<span class="string">'rect'</span>).attr(<span class="string">'class'</span>, <span class="string">'chandle'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.sdim.w-handleWidth).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.dim.h).attr(<span class="string">'x'</span>, <span class="keyword">this</span>.sdim.x0 + handleWidth);
        <span class="keyword">this</span>.slider.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'lhandlegrp'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (<span class="keyword">this</span>.sdim.x0) + <span class="string">',0)'</span>).append(<span class="string">'path'</span>).attr(<span class="string">'d'</span>,<span class="string">'M'</span> + handleWidth + <span class="string">',0 A'</span> + handleWidth + <span class="string">','</span> + handleWidth + <span class="string">' 0 0,0 '</span> + handleWidth + <span class="string">','</span> + handleWidth * <span class="number">2</span> ).attr(<span class="string">'class'</span>, <span class="string">'lhandle'</span>).attr(<span class="string">'width'</span>, handleWidth).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.dim.h);
        <span class="keyword">this</span>.slider.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'rhandlegrp'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (<span class="keyword">this</span>.sdim.x0 + <span class="keyword">this</span>.sdim.w) + <span class="string">',0)'</span>).append(<span class="string">'path'</span>).attr(<span class="string">'d'</span>,<span class="string">'M0,0 A'</span> + handleWidth + <span class="string">','</span> + handleWidth + <span class="string">' 0 0,1 0,'</span> + handleWidth * <span class="number">2</span>).attr(<span class="string">'class'</span>, <span class="string">'rhandle'</span>).attr(<span class="string">'width'</span>, handleWidth).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.dim.h);
    
        <span class="keyword">this</span>.xscale = d3.scale.linear();
        <span class="keyword">this</span>.xscale.domain([<span class="number">0</span>, <span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length-<span class="number">1</span>]);
        <span class="keyword">this</span>.xscale.rangeRound([<span class="number">0</span>, <span class="keyword">this</span>.dim.w - <span class="number">2</span>*handleWidth]);
    
        <span class="keyword">this</span>.yscale = d3.scale.linear();
        <span class="keyword">this</span>.yscale.domain(<span class="keyword">this</span>.viz.model.get(<span class="string">'view'</span>).y.domain());
        <span class="keyword">this</span>.yscale.rangeRound([<span class="number">0</span>, <span class="keyword">this</span>.dim.h/<span class="number">2</span>]);
    
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
    
        <span class="keyword">this</span>.spikewidth = (<span class="keyword">this</span>.dim.w-<span class="number">2</span>*handleWidth) / <span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length;
    
        <span class="keyword">this</span>.spikes = <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'rect.sd'</span>).data(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>));
        <span class="keyword">this</span>.spikes.enter().append(<span class="string">'rect'</span>)
            .attr(<span class="string">'x'</span>, <span class="keyword">function</span>(d,i) { <span class="keyword">return</span> that.xscale(i); })
            .attr(<span class="string">'y'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> -that.yscale(d.wclass.remove + d.wclass.vand); })
            .attr(<span class="string">'width'</span>, <span class="keyword">function</span>(d,i) { <span class="keyword">return</span> that.spikewidth; })
            .attr(<span class="string">'height'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> that.yscale(d.loglev - (d.wclass.remove + d.wclass.vand))+that.yscale(d.wclass.remove + d.wclass.vand); })
            .attr(<span class="string">'class'</span>, <span class="string">'sd'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Draw talk page entries, need to manually keep this in sync with appendCallout for now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
        <span class="keyword">this</span>.dots = <span class="keyword">this</span>.bg.select(<span class="string">'g.navbars'</span>).selectAll(<span class="string">'circle.td'</span>).data(<span class="keyword">this</span>.viz.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>)).enter().append(<span class="string">'circle'</span>)
            .attr(<span class="string">'class'</span>, <span class="string">'td'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Max circle radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> maxR = <span class="number">5</span>;
        <span class="keyword">var</span> fact = <span class="number">0.6</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Append circle to our element. Cap the circle size and re-style the circle if it has reached the cap.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.dots.filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> Math.log(d.lev+<span class="number">1</span>)*fact &lt;= maxR; }).attr(<span class="string">'r'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> Math.log(d.lev+<span class="number">1</span>)*fact; }).attr(<span class="string">'class'</span>, <span class="string">'tcircle'</span>);
        <span class="keyword">this</span>.dots.filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> Math.log(d.lev+<span class="number">1</span>)*fact &gt; maxR; }).attr(<span class="string">'r'</span>, maxR).attr(<span class="string">'class'</span>, <span class="string">'tcircle_full'</span>);
    
        <span class="keyword">this</span>.sd = { dx: <span class="number">0</span> };</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Event handlers for the slider
The slider &quot;dragging&quot; state is stored as a CSS class.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.viz.$(<span class="string">'.chandle'</span>).mousedown(<span class="keyword">function</span>(event) {
            $(<span class="keyword">this</span>).addClass(<span class="string">'dragging'</span>);
            that.sd.dx = event.pageX - that.sdim.x0;
            event.preventDefault();
        });
        <span class="keyword">this</span>.viz.$(<span class="string">'.lhandle'</span>).mousedown(<span class="keyword">function</span>(event) {
            $(<span class="keyword">this</span>).addClass(<span class="string">'dragging'</span>);
            that.sd.dx = event.pageX - that.sdim.x0;
            event.preventDefault();
        });
        <span class="keyword">this</span>.viz.$(<span class="string">'.rhandle'</span>).mousedown(<span class="keyword">function</span>(event) {
            $(<span class="keyword">this</span>).addClass(<span class="string">'dragging'</span>);
            that.sd.dx = event.pageX;
            event.preventDefault();
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>More event handlers. These deal with dragging the slider.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(document).mousemove($.proxy(<span class="keyword">function</span>(event) {
            <span class="keyword">if</span> (<span class="keyword">this</span>.viz.$(<span class="string">'.rhandle'</span>).hasClass(<span class="string">'dragging'</span>)) {
                <span class="keyword">var</span> dw = (event.pageX - <span class="keyword">this</span>.sd.dx);
                <span class="keyword">this</span>.sd.dx = event.pageX;
                <span class="keyword">var</span> newW = +<span class="keyword">this</span>.sdim.w +dw;
            
                <span class="keyword">if</span> (newW &lt; handleWidth) newW = handleWidth;
                <span class="keyword">if</span> (newW + <span class="keyword">this</span>.sdim.x0 + handleWidth &gt; <span class="keyword">this</span>.dim.w) newW = <span class="keyword">this</span>.dim.w-<span class="keyword">this</span>.sdim.x0-handleWidth;
                <span class="keyword">this</span>.sdim.w = newW;
                
                <span class="keyword">this</span>.viz.$(<span class="string">'.chandle'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.sdim.w - handleWidth);
                <span class="keyword">this</span>.viz.$(<span class="string">'.rhandlegrp'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (+<span class="keyword">this</span>.sdim.w) + <span class="string">',0)'</span>)
                <span class="keyword">this</span>.onScale();
                <span class="keyword">this</span>.onSlide();
            }
            <span class="keyword">if</span> (<span class="keyword">this</span>.viz.$(<span class="string">'.lhandle'</span>).hasClass(<span class="string">'dragging'</span>)) {
                <span class="keyword">var</span> newX0 = (event.pageX - <span class="keyword">this</span>.sd.dx);
                <span class="keyword">if</span> (newX0 &lt; <span class="number">0</span>) newX0 = <span class="number">0</span>;
                <span class="keyword">if</span> (newX0 &gt; <span class="keyword">this</span>.sdim.x0 + <span class="keyword">this</span>.sdim.w - handleWidth) newX0 = <span class="keyword">this</span>.sdim.x0 + <span class="keyword">this</span>.sdim.w - handleWidth;
            
                <span class="keyword">var</span> newW = +<span class="keyword">this</span>.sdim.w - (+newX0 - +<span class="keyword">this</span>.sdim.x0);
                <span class="keyword">if</span> (newW &lt; handleWidth) {
                    newW = handleWidth;
                }
            
                <span class="keyword">this</span>.sdim.x0 = newX0;
                <span class="keyword">this</span>.sdim.w = newW;
            
                <span class="keyword">this</span>.viz.$(<span class="string">'.slider'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (<span class="keyword">this</span>.sdim.x0) + <span class="string">',0)'</span>);
                <span class="keyword">this</span>.viz.$(<span class="string">'.chandle'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.sdim.w - handleWidth);
                <span class="keyword">this</span>.viz.$(<span class="string">'.rhandlegrp'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (+<span class="keyword">this</span>.sdim.w) + <span class="string">',0)'</span>)
                <span class="keyword">this</span>.onScale();
                <span class="keyword">this</span>.onSlide();
            }
            <span class="keyword">if</span> (<span class="keyword">this</span>.viz.$(<span class="string">'.chandle'</span>).hasClass(<span class="string">'dragging'</span>)) {
                <span class="keyword">this</span>.sdim.x0 = (event.pageX - <span class="keyword">this</span>.sd.dx);
            
                <span class="keyword">if</span> (<span class="keyword">this</span>.sdim.x0 &lt; <span class="number">0</span>) <span class="keyword">this</span>.sdim.x0 = <span class="number">0</span>;
                <span class="keyword">if</span> (<span class="keyword">this</span>.sdim.x0 &gt; <span class="keyword">this</span>.dim.w - ((handleWidth) + <span class="keyword">this</span>.sdim.w)) <span class="keyword">this</span>.sdim.x0 = <span class="keyword">this</span>.dim.w - ((handleWidth) + <span class="keyword">this</span>.sdim.w);
                <span class="keyword">this</span>.viz.$(<span class="string">'.slider'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (<span class="keyword">this</span>.sdim.x0) + <span class="string">',0)'</span>);
                <span class="keyword">this</span>.onSlide();
            }
        }, <span class="keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Once the mouse is released, reset the slider &quot;dragging&quot; state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(document).mouseup($.proxy(<span class="keyword">function</span>() {
            <span class="keyword">this</span>.viz.$(<span class="string">'.chandle'</span>).removeClass(<span class="string">'dragging'</span>);
            <span class="keyword">this</span>.viz.$(<span class="string">'.lhandle'</span>).removeClass(<span class="string">'dragging'</span>);
            <span class="keyword">this</span>.viz.$(<span class="string">'.rhandle'</span>).removeClass(<span class="string">'dragging'</span>);
        }, <span class="keyword">this</span>));
    
        <span class="keyword">this</span>.handleWidth = handleWidth;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Call these to update the slider for the first time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.onSlide();
        <span class="keyword">this</span>.onScale();
        <span class="keyword">this</span>.changeMode();
    }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <h2>NewArticleView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>NewArticleView = Backbone.View.extend({    
    
    template: _.template($(<span class="string">"#new_article_template"</span>).html()),
    views: <span class="keyword">new</span> Array(),
    
    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.articleSets = <span class="keyword">new</span> ArticleSetCollection();
        <span class="keyword">this</span>.userSets = <span class="keyword">new</span> UserSetCollection();
        <span class="keyword">this</span>.users = <span class="keyword">new</span> UserCollection();
        <span class="keyword">this</span>.articles = <span class="keyword">new</span> ArticleCollection();
        
        $.when(<span class="keyword">this</span>.users.fetch(),
               <span class="keyword">this</span>.articles.fetch(),
               <span class="keyword">this</span>.articleSets.fetch(),
               <span class="keyword">this</span>.userSets.fetch()).then($.proxy(<span class="keyword">function</span>(){<span class="keyword">this</span>.render();}, <span class="keyword">this</span>));
        
        <span class="keyword">var</span> id = _.uniqueId();
        $(<span class="string">"#content"</span>).append(<span class="string">"&lt;div id='"</span> + id + <span class="string">"'&gt;"</span>);
        <span class="keyword">this</span>.$el = $(<span class="string">"#"</span> + id);
        <span class="keyword">this</span>.el = $(<span class="string">"#"</span> + id)[<span class="number">0</span>];
    },
    
    events: {
        <span class="string">"click #initiative .option:not(.disabled)"</span>: <span class="string">"clickInitiative"</span>,
        <span class="string">"click #set .option"</span>: <span class="string">"clickDataSet"</span>,
        <span class="string">"click #project .option"</span>: <span class="string">"clickProject"</span>,
        <span class="string">"click #analyse button"</span>: <span class="string">"clickAnalyse"</span>,
        <span class="string">"click #clearFilter"</span>: <span class="string">"clearFilter"</span>,
        <span class="string">"change #filter"</span>: <span class="string">"filter"</span>,
        <span class="string">"keyup #filter"</span>: <span class="string">"filter"</span>
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Returns the selected Article/User, or null if nothing is selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getSelected: <span class="keyword">function</span>(){
        <span class="keyword">var</span> model = <span class="literal">null</span>;
        _.each(<span class="keyword">this</span>.views, <span class="keyword">function</span>(view){
            <span class="keyword">if</span>(view.$el.hasClass(<span class="string">'selected'</span>)){
                model = view.model;
            }
        });
        <span class="keyword">return</span> model;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Clears the contents of the filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clearFilter: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$(<span class="string">"#filter"</span>).attr(<span class="string">'value'</span>, <span class="string">""</span>);
        <span class="keyword">this</span>.filter();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Triggered when one of the options in the initiative list is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clickInitiative: <span class="keyword">function</span>(e){
        <span class="keyword">this</span>.$(<span class="string">"#initiative .option"</span>).not(e.currentTarget).removeClass(<span class="string">'selected'</span>);
        $(e.currentTarget).toggleClass(<span class="string">'selected'</span>);
        <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#set"</span>).css(<span class="string">'display'</span>) == <span class="string">'none'</span> &amp;&amp;
           <span class="keyword">this</span>.$(<span class="string">"#initiative .option.selected"</span>).length &gt; <span class="number">0</span>){
            <span class="keyword">this</span>.renderDataSets();
            <span class="keyword">this</span>.$(<span class="string">"#set"</span>).show(<span class="string">'slide'</span>, <span class="number">400</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#set"</span>).css(<span class="string">'display'</span>) != <span class="string">'none'</span> &amp;&amp; 
                <span class="keyword">this</span>.$(<span class="string">"#initiative .option.selected"</span>).length == <span class="number">0</span>){
            <span class="keyword">this</span>.$(<span class="string">"#set"</span>).hide(<span class="string">'slide'</span>, <span class="number">400</span>);
            <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#project"</span>).css(<span class="string">'display'</span>) != <span class="string">'none'</span>){
                <span class="keyword">this</span>.$(<span class="string">"#project"</span>).hide(<span class="string">'slide'</span>, <span class="number">400</span>);
                <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).css(<span class="string">'display'</span>) != <span class="string">'none'</span>){
                    <span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).hide(<span class="string">'slide'</span>, <span class="number">400</span>);
                }
            }
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Triggered when one of the options in the initiative list is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clickDataSet: <span class="keyword">function</span>(e){
        <span class="keyword">this</span>.$(<span class="string">"#set .option"</span>).not(e.currentTarget).removeClass(<span class="string">'selected'</span>);
        $(e.currentTarget).toggleClass(<span class="string">'selected'</span>);
        <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#set .option.selected"</span>).length &gt; <span class="number">0</span>){
            <span class="keyword">var</span> span = <span class="keyword">this</span>.$(<span class="string">"#set .option.selected span"</span>);
            <span class="keyword">if</span>(span.parent().hasClass(<span class="string">"article"</span>)){
                <span class="keyword">this</span>.renderProjects(<span class="keyword">this</span>.articles.where({<span class="string">'set'</span>: parseInt(span.attr(<span class="string">'name'</span>))}));
            }
            <span class="keyword">else</span> <span class="keyword">if</span>(span.parent().hasClass(<span class="string">"contributor"</span>)){
                <span class="keyword">this</span>.renderProjects(<span class="keyword">this</span>.users.where({<span class="string">'set'</span>: parseInt(span.attr(<span class="string">'name'</span>))}));
            }
            <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#project"</span>).css(<span class="string">'display'</span>) == <span class="string">'none'</span>){
                <span class="keyword">this</span>.$(<span class="string">"#project"</span>).show(<span class="string">'slide'</span>, <span class="number">400</span>);
            }
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#project"</span>).css(<span class="string">'display'</span>) != <span class="string">'none'</span> &amp;&amp; 
                <span class="keyword">this</span>.$(<span class="string">"#set .option.selected"</span>).length == <span class="number">0</span>){
            <span class="keyword">this</span>.$(<span class="string">"#project"</span>).hide(<span class="string">'slide'</span>, <span class="number">400</span>);
            <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).css(<span class="string">'display'</span>) != <span class="string">'none'</span>){
                <span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).hide(<span class="string">'slide'</span>, <span class="number">400</span>);
            }
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Triggered when one of the options in the project/contributor list is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clickProject: <span class="keyword">function</span>(e){
        <span class="keyword">this</span>.$(<span class="string">"#project .option"</span>).not(e.currentTarget).removeClass(<span class="string">'selected'</span>);
        $(e.currentTarget).toggleClass(<span class="string">'selected'</span>);
        <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).css(<span class="string">'display'</span>) == <span class="string">'none'</span> &amp;&amp;
           <span class="keyword">this</span>.$(<span class="string">"#project .option.selected"</span>).length &gt; <span class="number">0</span>){
            <span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).show(<span class="string">'slide'</span>, <span class="number">400</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).css(<span class="string">'display'</span>) != <span class="string">'none'</span> &amp;&amp; 
                <span class="keyword">this</span>.$(<span class="string">"#project .option.selected"</span>).length == <span class="number">0</span>){
            <span class="keyword">this</span>.$(<span class="string">"#analyse"</span>).hide(<span class="string">'slide'</span>, <span class="number">400</span>);
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Triggered when the analyse button is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clickAnalyse: <span class="keyword">function</span>(e){
        <span class="keyword">var</span> selected = <span class="keyword">this</span>.getSelected();
        <span class="keyword">var</span> view = <span class="literal">null</span>;
        <span class="keyword">var</span> title = <span class="string">""</span>;
        <span class="keyword">var</span> color = <span class="string">""</span>;
        <span class="keyword">var</span> hoverColor = <span class="string">""</span>;
        <span class="keyword">if</span>(selected <span class="keyword">instanceof</span> Article){
            view = <span class="keyword">new</span> ArticleView({model: selected});
            title = selected.get(<span class="string">'title'</span>);
            color = <span class="string">"#ABD1EB"</span>;
            hoverColor = <span class="string">"#9EC0D9"</span>;
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(selected <span class="keyword">instanceof</span> User){
            view = <span class="keyword">new</span> UserView({model: selected});
            title = selected.get(<span class="string">'name'</span>);
            color = <span class="string">"#EEADAD"</span>;
            hoverColor = <span class="string">"#EE9898"</span>;
        }
        <span class="keyword">else</span> {
            <span class="keyword">return</span>;
        }
        topTabs.getSelected().set({
            <span class="string">'title'</span>: title,
            <span class="string">'mainView'</span>: view,
            <span class="string">'color'</span>: color, 
            <span class="string">'hoverColor'</span>: hoverColor
        });
        view.render();
        topTabsView.render();
        <span class="keyword">this</span>.remove();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Renders the initiatives list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderInitiatives: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(_.size(<span class="keyword">this</span>.articles.toJSON()) == <span class="number">0</span>){
            <span class="keyword">this</span>.$(<span class="string">"#initiative .select"</span>).html($(<span class="string">"#big_throbber_template"</span>).html());
        }
        <span class="keyword">this</span>.$(<span class="string">"#initiative"</span>).tabs();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Renders the projects/contributors data set list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderDataSets: <span class="keyword">function</span>(){
        <span class="keyword">var</span> artSets = document.createDocumentFragment();
        <span class="keyword">var</span> userSets = document.createDocumentFragment();
        _.each(<span class="keyword">this</span>.views, <span class="keyword">function</span>(view){
            <span class="keyword">if</span>(view <span class="keyword">instanceof</span> DataSetView){
                view.remove();
            }
        });
        <span class="keyword">this</span>.views = <span class="keyword">new</span> Array();
        _.each(<span class="keyword">this</span>.articleSets.models, <span class="keyword">function</span>(article){
            <span class="keyword">var</span> view = <span class="keyword">new</span> DataSetView({model: article});
            <span class="keyword">this</span>.views.push(view);
            artSets.appendChild(view.render()[<span class="number">0</span>]);
        }, <span class="keyword">this</span>);
        _.each(<span class="keyword">this</span>.userSets.models, <span class="keyword">function</span>(user){
            <span class="keyword">var</span> view = <span class="keyword">new</span> DataSetView({model: user});
            <span class="keyword">this</span>.views.push(view);
            userSets.appendChild(view.render()[<span class="number">0</span>]);
        }, <span class="keyword">this</span>);
        <span class="keyword">this</span>.$(<span class="string">"#set #tabs-project .select"</span>).html(artSets);
        <span class="keyword">this</span>.$(<span class="string">"#set #tabs-contributor .select"</span>).html(userSets);
        <span class="keyword">this</span>.$(<span class="string">"#set"</span>).tabs();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Renders the projects/contributors list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderProjects: <span class="keyword">function</span>(set){
        <span class="keyword">var</span> articles = document.createDocumentFragment();
        <span class="keyword">var</span> users = document.createDocumentFragment();
        _.each(<span class="keyword">this</span>.views, <span class="keyword">function</span>(view){
            <span class="keyword">if</span>(view <span class="keyword">instanceof</span> ProjectView){
                view.remove();
            }
        });
        <span class="keyword">this</span>.views = <span class="keyword">new</span> Array();
        _.each(set, <span class="keyword">function</span>(article){
            <span class="keyword">var</span> view = <span class="keyword">new</span> ProjectView({model: article});
            <span class="keyword">this</span>.views.push(view);
            articles.appendChild(view.render()[<span class="number">0</span>]);
        }, <span class="keyword">this</span>);
        <span class="keyword">this</span>.$(<span class="string">"#project #tabs-item .select"</span>).html(articles);
        <span class="keyword">this</span>.$(<span class="string">"#project"</span>).tabs();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Filters the options which appear in the selection list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    filter: <span class="keyword">function</span>(){
        <span class="keyword">var</span> filterVal = <span class="keyword">this</span>.$(<span class="string">"#filter"</span>).val().toLowerCase();
        _.each(<span class="keyword">this</span>.articles.models, <span class="keyword">function</span>(article){
            <span class="keyword">if</span>(article.get(<span class="string">'title'</span>).toLowerCase().indexOf(filterVal) != -<span class="number">1</span>){
                article.set(<span class="string">'display'</span>, <span class="literal">true</span>);
            }
            <span class="keyword">else</span>{
                article.set(<span class="string">'display'</span>, <span class="literal">false</span>);
            }
        });
        _.each(<span class="keyword">this</span>.users.models, <span class="keyword">function</span>(user){
            <span class="keyword">if</span>(user.get(<span class="string">'name'</span>).toLowerCase().indexOf(filterVal) != -<span class="number">1</span>){
                user.set(<span class="string">'display'</span>, <span class="literal">true</span>);
            }
            <span class="keyword">else</span>{
                user.set(<span class="string">'display'</span>, <span class="literal">false</span>);
            }
        });
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template({<span class="string">'count'</span>: _.size(<span class="keyword">this</span>.articles.toJSON())}));
        <span class="keyword">this</span>.renderInitiatives();
	    <span class="keyword">return</span> <span class="keyword">this</span>.$el;
	}
});</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <h2>DataSetView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>DataSetView = Backbone.View.extend({

    template: _.template($(<span class="string">"#dataset_option_template"</span>).html()),

    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">'change'</span>, <span class="keyword">this</span>.render);
        <span class="keyword">this</span>.$el.addClass(<span class="string">"option"</span>);
        <span class="keyword">if</span>(<span class="keyword">this</span>.model <span class="keyword">instanceof</span> UserSet){
            <span class="keyword">this</span>.$el.addClass(<span class="string">"contributor"</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.model <span class="keyword">instanceof</span> ArticleSet){
            <span class="keyword">this</span>.$el.addClass(<span class="string">"article"</span>);
        }
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(<span class="keyword">this</span>.model.toJSON()));
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <h2>ProjectView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>ProjectView = Backbone.View.extend({

    article_template: _.template($(<span class="string">"#article_option_template"</span>).html()),
    user_template: _.template($(<span class="string">"#user_option_template"</span>).html()),

    initialize: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.model <span class="keyword">instanceof</span> Article){
            <span class="keyword">this</span>.template = <span class="keyword">this</span>.article_template;
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.model <span class="keyword">instanceof</span> User){
            <span class="keyword">this</span>.template = <span class="keyword">this</span>.user_template;
        }
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">'change'</span>, <span class="keyword">this</span>.render);
        <span class="keyword">this</span>.$el.addClass(<span class="string">"option"</span>);
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'display'</span>)){
            <span class="keyword">this</span>.$el.css(<span class="string">'display'</span>, <span class="string">'block'</span>);
            <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(<span class="keyword">this</span>.model.toJSON()));
        }
        <span class="keyword">else</span>{
            <span class="keyword">this</span>.$el.css(<span class="string">'display'</span>, <span class="string">'none'</span>);
        }
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <h2>ToolbarView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>ToolbarView = Backbone.View.extend({

    initialize: <span class="keyword">function</span>(options){
        <span class="keyword">this</span>.template = _.template($(<span class="string">"#toolbar_template"</span>).html());
        Backbone.Subviews.add(<span class="keyword">this</span>);
        <span class="keyword">this</span>.view = options.view;
    },
    
    subviewCreators:{
        <span class="string">"diag_cursor"</span> : <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_cursor_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    width: <span class="string">'auto'</span>,
                    resizable: <span class="literal">false</span>
                }
            });
        },
        <span class="string">"diag_options"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_options_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    resizable: <span class="literal">false</span>
                }
            });
        },
        <span class="string">"diag_select"</span>: <span class="keyword">function</span>(){
            <span class="keyword">var</span> wikiviz = <span class="keyword">this</span>.view.wikiviz;
            <span class="keyword">var</span> article = <span class="keyword">this</span>.view;
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_select_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    width: <span class="number">400</span>,
                    resizable: <span class="literal">false</span>
                },
                onCreate: <span class="keyword">function</span>(dialog){
                    $(<span class="string">'#select_apply'</span>, dialog).button();
                    $(<span class="string">'#d_select_tabs'</span>, dialog).tabs();
                    $(<span class="string">'#d_select_groups_accordion'</span>, dialog).accordion({
                        collapsible: <span class="literal">true</span>,
                        active: <span class="literal">false</span>,
                        autoHeight: <span class="literal">false</span>,
                        clearStyle: <span class="literal">true</span>
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Allow checkbox to capture click events (otherwise the accordion will do so)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#d_select_groups_accordion h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).click(<span class="keyword">function</span>(e) {
                            e.stopPropagation();
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>User group selection functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#d_select_groups_accordion h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).change(<span class="keyword">function</span>(e) {
                            <span class="keyword">var</span> that = $(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>If the event is the checking of a checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="keyword">if</span> ($(<span class="keyword">this</span>).attr(<span class="string">'checked'</span>)) {
                                wikiviz.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> d.group == that.val(); }).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Checkbox was unchecked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            } <span class="keyword">else</span> {
                                wikiviz.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> d.group == that.val(); }).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">0.2</span>);
                            }
                            $(<span class="string">'#t_deselect'</span>, dialog).button(<span class="string">'enable'</span>);
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Bind functionality to the select users dialog
Note that the &quot;Select By Group&quot; checkboxes make changes to the selection
in the Select By User list, so we really only need to grab the input from the select
by user list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'input[name=userclassselect]'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i,e)</span> {</span>
                        $(e).change(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Gather choices</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="keyword">var</span> filt = Array();
                            $(<span class="string">'input[name=userclassselect]:checked'</span>, dialog).each(<span class="keyword">function</span>(i, el) {
                                filt.push($(el).val());
                            });</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Use choices to generate selection in Select By User
User names are stored in the &quot;value&quot; property of the options in the select element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            $(<span class="string">'#userselect option'</span>, dialog).each(<span class="keyword">function</span>(i, e) {
                                <span class="keyword">if</span> (Helper.isSubset([wikiviz.getGroupsByName($(e).val())], filt)) {
                                    $(e).attr(<span class="string">'selected'</span>, <span class="literal">true</span>);
                                } <span class="keyword">else</span> {
                                    $(e).attr(<span class="string">'selected'</span>, <span class="literal">false</span>);
                                }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Force visual update on stubborn browsers (Chrome !!!)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                $(e).addClass(<span class="string">'invisible'</span>);
                                $(e).removeClass(<span class="string">'invisible'</span>);
                            });
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Clicking &quot;Apply User Selection&quot;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#select_apply'</span>, dialog).click(<span class="keyword">function</span>() {
                        <span class="keyword">var</span> users = Array();
                        $(<span class="string">'#userselect option:selected'</span>, dialog).each(<span class="keyword">function</span>() { users.push($(<span class="keyword">this</span>).val()); });
                        article.viz.applyUserSelection(users);
                    });
                }
            });
        },
        <span class="string">"diag_articles"</span>: <span class="keyword">function</span>(){
            <span class="keyword">var</span> wikiviz = <span class="keyword">this</span>.view.wikiviz;
            <span class="keyword">var</span> article = <span class="keyword">this</span>.view;
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_articles_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    width: <span class="number">400</span>,
                    resizable: <span class="literal">false</span>
                },
                onCreate: <span class="keyword">function</span>(dialog){
                    $(<span class="string">'#select_apply'</span>, dialog).button();
                    $(<span class="string">'#d_select_tabs'</span>, dialog).tabs();
                    $(<span class="string">'#d_select_groups_accordion'</span>, dialog).accordion({
                        collapsible: <span class="literal">true</span>,
                        active: <span class="literal">false</span>,
                        autoHeight: <span class="literal">false</span>,
                        clearStyle: <span class="literal">true</span>
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Allow checkbox to capture click events (otherwise the accordion will do so)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#d_select_groups_accordion h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).click(<span class="keyword">function</span>(e) {
                            e.stopPropagation();
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>User group selection functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#d_select_groups_accordion h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).change(<span class="keyword">function</span>(e) {
                            <span class="keyword">var</span> that = $(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>If the event is the checking of a checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="keyword">if</span> ($(<span class="keyword">this</span>).attr(<span class="string">'checked'</span>)) {
                                wikiviz.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> d.group == that.val(); }).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Checkbox was unchecked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            } <span class="keyword">else</span> {
                                wikiviz.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> d.group == that.val(); }).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">0.2</span>);
                            }
                            $(<span class="string">'#t_deselect'</span>, dialog).button(<span class="string">'enable'</span>);
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Bind functionality to the select users dialog
Note that the &quot;Select By Group&quot; checkboxes make changes to the selection
in the Select By User list, so we really only need to grab the input from the select
by user list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'input[name=userclassselect]'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i,e)</span> {</span>
                        $(e).change(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Gather choices</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="keyword">var</span> filt = Array();
                            $(<span class="string">'input[name=userclassselect]:checked'</span>, dialog).each(<span class="keyword">function</span>(i, el) {
                                filt.push($(el).val());
                            });</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Use choices to generate selection in Select By User
User names are stored in the &quot;value&quot; property of the options in the select element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            $(<span class="string">'#userselect option'</span>, dialog).each(<span class="keyword">function</span>(i, e) {
                                <span class="keyword">if</span> (Helper.isSubset([wikiviz.getGroupsByName($(e).val())], filt)) {
                                    $(e).attr(<span class="string">'selected'</span>, <span class="literal">true</span>);
                                } <span class="keyword">else</span> {
                                    $(e).attr(<span class="string">'selected'</span>, <span class="literal">false</span>);
                                }</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Force visual update on stubborn browsers (Chrome !!!)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                $(e).addClass(<span class="string">'invisible'</span>);
                                $(e).removeClass(<span class="string">'invisible'</span>);
                            });
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Clicking &quot;Apply User Selection&quot;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#select_apply'</span>, dialog).click(<span class="keyword">function</span>() {
                        <span class="keyword">var</span> users = Array();
                        $(<span class="string">'#userselect option:selected'</span>, dialog).each(<span class="keyword">function</span>() { users.push($(<span class="keyword">this</span>).val()); });
                        article.viz.applyUserSelection(users);
                    });
                }
            });
        },
        <span class="string">"diag_info"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_info_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    resizable: <span class="literal">false</span>,
                    width: <span class="number">400</span>
                }
            });
        },
        <span class="string">"diag_data"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_data_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    resizable: <span class="literal">true</span>,
                    width: <span class="number">800</span>,
                    height: <span class="number">600</span>
                }
            });
        },
        <span class="string">"diag_legend"</span>: <span class="keyword">function</span>(){
            <span class="keyword">var</span> wikiviz = <span class="keyword">this</span>.view.wikiviz;
            <span class="keyword">var</span> article = <span class="keyword">this</span>.view;
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_legend_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    resizable: <span class="literal">false</span>,
                    height: <span class="string">'auto'</span>,
                    width: <span class="number">400</span>
                },
                onCreate: <span class="keyword">function</span>(dialog){
                    $(<span class="string">'#d_legend_accordion'</span>, dialog).accordion({
                        collapsible: <span class="literal">true</span>,
                        active: <span class="literal">false</span>,
                        autoHeight: <span class="literal">false</span>,
                        clearStyle: <span class="literal">true</span>
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Allow checkbox to capture click events (otherwise the accordion will do so)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'.d_checkable h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).click(<span class="keyword">function</span>(e) {
                            e.stopPropagation();
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Mapping from checkbox value to visualization rectangle classes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="keyword">var</span> classMap = {
                        addrem: [<span class="string">'add'</span>, <span class="string">'remove'</span>],
                        edit: [<span class="string">'edit'</span>],
                        reorganize: [<span class="string">'reorganize'</span>],
                        cite: [<span class="string">'cite'</span>],
                        unsure: [<span class="string">'unsure'</span>],
                        vandunvand: [<span class="string">'vand'</span>, <span class="string">'unvand'</span>]
                    };</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Legend selection functionality (by varyng opacity)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#d_legend_accordion h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).change(<span class="keyword">function</span>(e) {</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>If the event is the checking of a checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="keyword">if</span> ($(<span class="keyword">this</span>).attr(<span class="string">'checked'</span>)) {
                                <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> classMap[$(<span class="keyword">this</span>).val()]) {
                                    wikiviz.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'rect.'</span> + classMap[$(<span class="keyword">this</span>).val()][i]).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
                                }</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Checkbox was unchecked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            } <span class="keyword">else</span> {
                                <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> classMap[$(<span class="keyword">this</span>).val()]) {
                                    wikiviz.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'rect.'</span> + classMap[$(<span class="keyword">this</span>).val()][i]).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">0.2</span>);
                                }
                            }
                        
                            <span class="keyword">var</span> selected = <span class="keyword">new</span> Array();
                            $(<span class="string">'#d_legend_accordion input:checked'</span>, dialog).each(<span class="keyword">function</span>(i, v) {
                                $.merge(selected, classMap[$(v).val()]);
                            });
                        
                            article.viz.navctl.bg.selectAll(<span class="string">'rect'</span>).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>,
                                <span class="keyword">function</span>(d) {
                                    <span class="keyword">var</span> found = <span class="number">0.2</span>;
                                    $(selected).each(
                                        <span class="keyword">function</span>(i, v) {
                                            <span class="keyword">if</span> (d.wclass[v]) {
                                                found = <span class="number">1</span>;
                                                <span class="keyword">return</span> <span class="number">1</span>;
                                            }
                                        }
                                    );
                                    <span class="keyword">return</span> found;
                                }
                            );
                            $(<span class="string">'#t_deselect'</span>, dialog).button(<span class="string">'enable'</span>);
                        });
                    });
                }
            });
        },
        <span class="string">"diag_talk"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> DialogView({
                template: <span class="string">"diag_talk_template"</span>,
                options: {
                    autoOpen: <span class="literal">false</span>,
                    resizable: <span class="literal">false</span>,
                    height: <span class="string">'auto'</span>,
                    width: <span class="number">400</span>
                },
                onCreate: <span class="keyword">function</span>(dialog){
                    $(<span class="string">'#d_talk_accordion'</span>, dialog).accordion({
                        collapsible: <span class="literal">true</span>,
                        active: <span class="literal">false</span>,
                        autoHeight: <span class="literal">false</span>,
                        clearStyle: <span class="literal">true</span>
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Allow checkbox to capture click events (otherwise the accordion will do so)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'.d_checkable h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).click(<span class="keyword">function</span>(e) {
                            e.stopPropagation();
                        });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Talk page revision selection functionality.
TODO: Make the &quot;callouts&quot; fade out if all of the contained elements are faded out.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(<span class="string">'#d_talk_accordion h3'</span>, dialog).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, el)</span> {</span>
                        $(el).find(<span class="string">'input'</span>).change(<span class="keyword">function</span>(e) {
                            <span class="keyword">var</span> that = $(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>If the event is the checking of a checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="keyword">if</span> ($(<span class="keyword">this</span>).attr(<span class="string">'checked'</span>)) {
                                d3.selectAll(<span class="string">'.tdatum .'</span>+that.val()).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Checkbox was unchecked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            } <span class="keyword">else</span> {
                                d3.selectAll(<span class="string">'.tdatum .'</span>+that.val()).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">0.2</span>);
                            }
                            $(<span class="string">'#t_deselect'</span>, dialog).button(<span class="string">'enable'</span>);
                        });
                    });
                }
            });
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Init the buttons on the toolbar.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    createToolbar: <span class="keyword">function</span>() {
        $(<span class="string">'#t_cursor'</span>).button({
            icons: {
                primary: <span class="string">'ui-icon-arrow-1-ne'</span>
            },
            text: <span class="literal">false</span>
        });
        $(<span class="string">'#t_options'</span>).button({
            icons: {
                primary: <span class="string">'ui-icon-gear'</span>
            },
            text: <span class="literal">false</span>
        });
        <span class="keyword">this</span>.$(<span class="string">'#t_select'</span>).button({
            icons: {
                primary: <span class="string">'icon-users'</span>
            },
            text: <span class="literal">false</span>
        });
        <span class="keyword">this</span>.$(<span class="string">'#t_articles'</span>).button({
            icons: {
                primary: <span class="string">'icon-articles'</span>
            },
            text: <span class="literal">false</span>
        });
        $(<span class="string">'#t_info'</span>).button({
            icons: {
                primary: <span class="string">'ui-icon-info'</span>
            },
            text: <span class="literal">false</span>
        });
        <span class="keyword">this</span>.$(<span class="string">'#t_data'</span>).button({
            icons: {
                primary: <span class="string">'icon-table'</span>
            },
            text: <span class="literal">false</span>
        });
        <span class="keyword">this</span>.$(<span class="string">'#t_legend'</span>).button({
            icons: {
                primary: <span class="string">'icon-categories'</span>
            },
            text: <span class="literal">false</span>
        });
        <span class="keyword">this</span>.$(<span class="string">'#t_deselect'</span>).button({
            icons: {
                primary: <span class="string">'icon-deselect'</span>
            },
            text: <span class="literal">false</span>,
            disabled: <span class="literal">true</span>
        });
    
        <span class="keyword">this</span>.$(<span class="string">'#t_talk'</span>).button({
            icons: {
                primary: <span class="string">'icon-talk'</span>
            },
            text: <span class="literal">false</span>,
            disabled: <span class="literal">true</span>
        });
    },
    
    events: {
        <span class="string">"click #t_cursor"</span>:  <span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_cursor.open();},
        <span class="string">"click #t_options"</span>: <span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_options.open();},
        <span class="string">"click #t_select"</span>:  <span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_select.open();},
        <span class="string">"click #t_articles"</span>:<span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_articles.open();},
        <span class="string">"click #t_info"</span>:    <span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_info.open();},
        <span class="string">"click #t_data"</span>:    <span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_data.open();},
        <span class="string">"click #t_legend"</span>:  <span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_legend.open();},
        <span class="string">"click #t_deselect"</span>:<span class="keyword">function</span>(){<span class="keyword">this</span>.view.viz.clearAllSelections(<span class="literal">true</span>);},
        <span class="string">"click #t_talk"</span>:    <span class="keyword">function</span>(){<span class="keyword">this</span>.subviews.diag_talk.open();}
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(<span class="keyword">this</span>.model));
        <span class="keyword">this</span>.createToolbar();
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <h2>TopTabsView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>TopTabsView = Backbone.View.extend({

    views: <span class="keyword">new</span> Array(),

    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">'add'</span>, <span class="keyword">this</span>.render);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">'remove'</span>, <span class="keyword">this</span>.render);
        $(window).resize($.proxy(<span class="keyword">this</span>.render, <span class="keyword">this</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Orders each tab and spacing them correctly.</p>
<p>First the tabs are sorted based on their x position,
then they are spaced and rerendered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    order: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.model.sort();
        <span class="keyword">var</span> startX = TopTabsView.leftMargin;
        <span class="keyword">var</span> widthEstimate = (($(<span class="string">"#content"</span>).outerWidth()-<span class="number">30</span>-<span class="number">30</span>-TopTabsView.spacing)/(<span class="keyword">this</span>.model.length-<span class="number">1</span>)) - <span class="number">25</span> - <span class="number">10</span> - TopTabsView.spacing;
        <span class="keyword">var</span> widthSum = <span class="number">0</span>;
        <span class="keyword">var</span> actualSum = <span class="number">0</span>;
        <span class="keyword">this</span>.model.each(<span class="keyword">function</span>(tab, index){
            <span class="keyword">var</span> before = tab.get(<span class="string">'x'</span>);
            tab.set(<span class="string">'x'</span>, startX, {silent: <span class="literal">true</span>});
            <span class="keyword">var</span> extraWidth = <span class="number">0</span>;
            <span class="keyword">if</span>(tab.get(<span class="string">'type'</span>) != <span class="string">'new'</span>){
                widthSum += widthEstimate + <span class="number">25</span> + <span class="number">10</span> + <span class="number">5</span>;
                actualSum += Math.max(<span class="number">5</span>, Math.min(<span class="number">150</span>, Math.round(widthEstimate))) + <span class="number">25</span> + <span class="number">10</span> + <span class="number">5</span>;
                <span class="keyword">var</span> diff = widthSum - actualSum;
                actualSum += diff;</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>TODO: This isn&#39;t perfect, some rounding problems still exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">this</span>.$(<span class="string">"#tab_"</span> + tab.cid).css(<span class="string">'max-width'</span>, Math.max(<span class="number">5</span>, Math.min(<span class="number">150</span>, Math.round(widthEstimate) + diff)));
            }
            startX += Math.round(<span class="keyword">this</span>.$(<span class="string">"#tab_"</span> + tab.cid).outerWidth()) + TopTabsView.spacing;
            <span class="keyword">if</span>(before != tab.get(<span class="string">'x'</span>)){
                <span class="keyword">this</span>.views[index].updatePosition();
            }
        }, <span class="keyword">this</span>);
    },
    
    render: <span class="keyword">function</span>(){
        _.each(<span class="keyword">this</span>.views, <span class="keyword">function</span>(view){
            view.remove();
        });
        <span class="keyword">this</span>.views = <span class="keyword">new</span> Array();
        <span class="keyword">this</span>.$el.empty();
        <span class="keyword">this</span>.model.each(<span class="keyword">function</span>(tab){
            <span class="keyword">var</span> tabView = <span class="keyword">new</span> TopTabView({model: tab});
            <span class="keyword">this</span>.$el.append(tabView.render());
            <span class="keyword">if</span>(tab.get(<span class="string">'type'</span>) == <span class="string">'tab'</span>){
                tabView.$el.draggable({
                    axis: <span class="string">"x"</span>,
                    start: $.proxy(<span class="keyword">function</span>(e, ui){
                        tabView.$el.css(<span class="string">'z-index'</span>, <span class="number">1000</span>);
                    }, <span class="keyword">this</span>),
                    drag: $.proxy(<span class="keyword">function</span>(e, ui){
                        tab.set(<span class="string">'x'</span>, parseInt(tabView.$el.css(<span class="string">'left'</span>)), {silent: <span class="literal">true</span>});
                        <span class="keyword">this</span>.order();
                    }, <span class="keyword">this</span>),
                    stop: $.proxy(<span class="keyword">function</span>(){
                        tabView.$el.css(<span class="string">'z-index'</span>, <span class="number">0</span>);
                        <span class="keyword">this</span>.order();
                        <span class="keyword">this</span>.render();
                    }, <span class="keyword">this</span>)
                });
            }
            <span class="keyword">this</span>.views.push(tabView);
        }, <span class="keyword">this</span>);
        <span class="keyword">this</span>.order();
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    },

});</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Left margin for first tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>TopTabsView.leftMargin = <span class="number">15</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Spacing between tabs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>TopTabsView.spacing = <span class="number">5</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <h2>TopTabView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>TopTabView = Backbone.View.extend({

    template: _.template($(<span class="string">"#top_tab_template"</span>).html()),

    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">'change'</span>, <span class="keyword">this</span>.render);
    },
    
    events: {
        <span class="string">"mouseover"</span>: <span class="string">"hover"</span>,
        <span class="string">"mouseout"</span>: <span class="string">"unhover"</span>,
        <span class="string">"click .x"</span>: <span class="string">"close"</span>,
        <span class="string">"click"</span>: <span class="string">"click"</span>
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Triggered when the tab is hovered.  Change hover color etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hover: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'selected'</span>)){
            <span class="keyword">this</span>.$el.css(<span class="string">'border-bottom'</span>, <span class="string">'1px solid #FFFFFF'</span>);
        }
        <span class="keyword">this</span>.$el.css(<span class="string">'background-color'</span>, <span class="keyword">this</span>.model.get(<span class="string">'hoverColor'</span>));
    },
    
    unhover: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'selected'</span>)){
            <span class="keyword">this</span>.$el.css(<span class="string">'border-bottom'</span>, <span class="string">'1px solid #FFFFFF'</span>);
        }
        <span class="keyword">else</span>{
            <span class="keyword">this</span>.$el.css(<span class="string">'border-bottom'</span>, <span class="string">'1px solid #AAAAAA'</span>);
        }
        <span class="keyword">this</span>.$el.css(<span class="string">'background-color'</span>, <span class="keyword">this</span>.model.get(<span class="string">'color'</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Triggered when a tab is clicked (clicking the &#39;x&#39; doesn&#39;t count)</p>
<p>If a &#39;+&#39; tab was clicked, then a new tab is created and selected, otherwise
the clicked tab is selected, and the previously selected tab is unselected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    click: <span class="keyword">function</span>(e){
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'type'</span>) == <span class="string">'new'</span>){
            <span class="keyword">var</span> tab = <span class="keyword">new</span> TopTab({title: <span class="string">"New Tab"</span>, mainView: <span class="keyword">new</span> NewArticleView({model: articles})});
            <span class="keyword">var</span> beforeX = _.last(topTabsView.views).model.get(<span class="string">'x'</span>);
            topTabs.add(tab);
            topTabsView.order();
            <span class="keyword">var</span> selected = topTabs.getSelected();
            <span class="keyword">if</span>(selected != <span class="literal">null</span> &amp;&amp; selected != <span class="keyword">this</span>.model){
                selected.set(<span class="string">'selected'</span>, <span class="literal">false</span>);
            }
            tab.set(<span class="string">'selected'</span>, <span class="literal">true</span>);
            $(<span class="string">"#tab_"</span> + tab.cid).css(<span class="string">'display'</span>, <span class="string">'none'</span>);
            $(<span class="string">"#tab_"</span> + tab.cid).show(<span class="string">'slide'</span>, <span class="number">200</span>);
            _.last(topTabsView.views).$el.css(<span class="string">'left'</span>, beforeX);
            _.last(topTabsView.views).$el.animate({
                <span class="string">'left'</span>: tab.get(<span class="string">'x'</span>) + $(<span class="string">"#tab_"</span> + tab.cid).outerWidth() + TopTabsView.spacing
            }, <span class="number">200</span>);
        }
        <span class="keyword">else</span>{
            <span class="keyword">if</span>(!$(e.target).hasClass(<span class="string">'x'</span>)){
                <span class="keyword">var</span> selected = topTabs.getSelected();
                <span class="keyword">if</span>(selected != <span class="literal">null</span> &amp;&amp; selected != <span class="keyword">this</span>.model){
                    selected.set(<span class="string">'selected'</span>, <span class="literal">false</span>);
                }
                <span class="keyword">if</span>(!<span class="keyword">this</span>.model.get(<span class="string">'selected'</span>)){
                    <span class="keyword">this</span>.model.set(<span class="string">'selected'</span>, <span class="literal">true</span>);
                }
            }
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Closes this tab and removes it.  The last tab is then selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    close: <span class="keyword">function</span>(){
        <span class="keyword">var</span> found = <span class="literal">false</span>;
        _.each(topTabsView.views, <span class="keyword">function</span>(tab){
            <span class="keyword">if</span>(found){
                tab.$el.animate({
                    <span class="string">'left'</span>: tab.model.get(<span class="string">'x'</span>) - <span class="keyword">this</span>.$el.outerWidth() - TopTabsView.spacing
                }, <span class="number">200</span>);
            }
            <span class="keyword">if</span>(tab == <span class="keyword">this</span>){
                found = <span class="literal">true</span>;
            }
        }, <span class="keyword">this</span>);
        <span class="keyword">this</span>.model.set(<span class="string">'selected'</span>, <span class="literal">false</span>);
        <span class="keyword">this</span>.model.get(<span class="string">'mainView'</span>).remove();
        <span class="keyword">this</span>.$el.hide(<span class="string">'slide'</span>, <span class="number">200</span>, $.proxy(<span class="keyword">function</span>(){
            topTabs.remove(<span class="keyword">this</span>.model);
            <span class="keyword">if</span>(topTabs.at(topTabs.length-<span class="number">2</span>)){
                topTabs.at(topTabs.length-<span class="number">2</span>).set(<span class="string">'selected'</span>, <span class="literal">true</span>);
            }
        }, <span class="keyword">this</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Updates the left coordinate of the tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updatePosition: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.css(<span class="string">'left'</span>, <span class="keyword">this</span>.model.get(<span class="string">'x'</span>));
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(<span class="keyword">this</span>.model.toJSON()));
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'type'</span>) == <span class="string">'new'</span>){
            <span class="keyword">this</span>.$el.addClass(<span class="string">'tab_new'</span>);
        }
        <span class="keyword">this</span>.$el.addClass(<span class="string">"tab"</span>);
        <span class="keyword">this</span>.$el.stop();
        <span class="keyword">this</span>.updatePosition();
        <span class="keyword">this</span>.$el.attr(<span class="string">'id'</span>, <span class="string">"tab_"</span> + <span class="keyword">this</span>.model.cid);
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'selected'</span>)){
            <span class="keyword">this</span>.$el.addClass(<span class="string">'selected'</span>);
            <span class="keyword">this</span>.$el.css(<span class="string">'border-bottom'</span>, <span class="string">'1px solid #FFFFFF'</span>);
        }
        <span class="keyword">else</span>{
            <span class="keyword">this</span>.$el.removeClass(<span class="string">'selected'</span>);
            <span class="keyword">this</span>.$el.css(<span class="string">'border-bottom'</span>, <span class="string">'1px solid #AAAAAA'</span>);
        }
        <span class="keyword">this</span>.$el.css(<span class="string">'background-color'</span>, <span class="keyword">this</span>.model.get(<span class="string">'color'</span>));
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }

});

UserInfoView = Backbone.View.extend({

    initialize: <span class="keyword">function</span>(options){
        <span class="keyword">this</span>.user = options.user;
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"sync"</span>, <span class="keyword">this</span>.render);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>), <span class="string">"sync"</span>, <span class="keyword">this</span>.render);
        <span class="keyword">this</span>.template = _.template($(<span class="string">"#user_info_template"</span>).html());
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(_.extend(<span class="keyword">this</span>.user.toJSON(), <span class="keyword">this</span>.model.toJSON())));
        <span class="keyword">this</span>.$el.attr(<span class="string">'id'</span>, <span class="string">"article_info"</span>);
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <h2>UserView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>UserView = Backbone.View.extend({
    
    template: _.template($(<span class="string">"#user_container_template"</span>).html()),
    wikiviz: <span class="literal">null</span>,
    navctl: <span class="literal">null</span>,
    
    initialize: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.wikiviz = <span class="keyword">new</span> WikiViz({user: <span class="keyword">this</span>.model.get(<span class="string">'name'</span>)});
        <span class="keyword">var</span> id = _.uniqueId();
        $(<span class="string">"#content"</span>).append(<span class="string">"&lt;div id='"</span> + id + <span class="string">"'&gt;"</span>);
        <span class="keyword">this</span>.$el = $(<span class="string">"#"</span> + id);
        <span class="keyword">this</span>.el = $(<span class="string">"#"</span> + id)[<span class="number">0</span>];
        Backbone.Subviews.add(<span class="keyword">this</span>);
    },
    
    subviewCreators : {
        <span class="string">"user_info"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> UserInfoView({model: <span class="keyword">this</span>.wikiviz, user: <span class="keyword">this</span>.model});
        },
        <span class="string">"toolbar"</span>: <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="keyword">new</span> ToolbarView({model: {<span class="string">'buttons'</span>: [<span class="string">'articles'</span>,<span class="string">'data'</span>,<span class="string">'legend'</span>,<span class="string">'deselect'</span>,<span class="string">'talk'</span>]}, view: <span class="keyword">this</span>});
        }
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(<span class="keyword">this</span>.model.toJSON()));
        <span class="keyword">this</span>.viz = <span class="keyword">new</span> WikiVizView({model: <span class="keyword">this</span>.wikiviz, view: <span class="keyword">this</span>, el: <span class="keyword">this</span>.el});
        <span class="keyword">this</span>.viz.init(<span class="keyword">this</span>.model.get(<span class="string">'title'</span>));
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }
    
});</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <h2>WikiVizView</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>WikiVizView = Backbone.View.extend({

    mouseX: <span class="number">0</span>,
    mouseY: <span class="number">0</span>,

    initialize: <span class="keyword">function</span>(options){
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>), <span class="string">"sync"</span>, <span class="keyword">this</span>.initViz);
        <span class="keyword">this</span>.navctl = <span class="keyword">new</span> NavCtlView({viz: <span class="keyword">this</span>});
        <span class="keyword">this</span>.view = options.view;
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"change:width"</span>, <span class="keyword">this</span>.initViz);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"change:height"</span>, <span class="keyword">this</span>.initViz);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"change:numDots"</span>, <span class="keyword">this</span>.updateDots);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"change:numBars"</span>, <span class="keyword">this</span>.updateBars);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"change:mode"</span>, <span class="keyword">this</span>.updateMode);
        <span class="keyword">this</span>.listenTo(<span class="keyword">this</span>.model, <span class="string">"change:isTimeSpaced"</span>, <span class="keyword">this</span>.updateSpacing);
        <span class="keyword">this</span>.$el.click($.proxy(<span class="keyword">function</span>(e){
            <span class="keyword">if</span>($(e.target).closest(<span class="string">".tooltip"</span>).length == <span class="number">0</span>){
                <span class="keyword">this</span>.$(<span class="string">".tooltip"</span>).hide();
            }
        }, <span class="keyword">this</span>));
        <span class="keyword">this</span>.$(<span class="string">"#view"</span>).mousemove($.proxy(<span class="keyword">function</span>(e){
            <span class="keyword">this</span>.mouseX = e.offsetX;
            <span class="keyword">this</span>.mouseY = e.offsetY;
        }, <span class="keyword">this</span>));
        $(window).resize($.proxy(<span class="keyword">function</span>(){
            <span class="keyword">if</span>(<span class="keyword">this</span>.$(<span class="string">"#view"</span>).width() &gt; <span class="number">0</span>){
                <span class="keyword">this</span>.model.set(<span class="string">'width'</span>, <span class="keyword">this</span>.$(<span class="string">"#view"</span>).width());
                <span class="keyword">this</span>.model.set(<span class="string">'height'</span>, <span class="keyword">this</span>.$(<span class="string">"#view"</span>).height());
            }
        }, <span class="keyword">this</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Calculate bar width based on number of bars per screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    calcBarWidth: <span class="keyword">function</span>(){
        <span class="keyword">var</span> w = (<span class="keyword">this</span>.model.get(<span class="string">'width'</span>) - <span class="keyword">this</span>.model.get(<span class="string">'maskWidth'</span>))/(<span class="keyword">this</span>.model.get(<span class="string">'numBars'</span>));
        <span class="keyword">if</span> (<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>)) { w = Math.min(w, <span class="number">7</span>); }
        <span class="keyword">return</span> w;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Calculate talk width based on number of talk entries per screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    calcTalkWidth: <span class="keyword">function</span>(){
        <span class="keyword">var</span> w = (<span class="keyword">this</span>.model.get(<span class="string">'width'</span>) - <span class="keyword">this</span>.model.get(<span class="string">'maskWidth'</span>))/(<span class="keyword">this</span>.model.get(<span class="string">'numDots'</span>));
        <span class="keyword">return</span> w;
    },

    getAdjacentTalkWidth: <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>width of one callout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>).length * <span class="number">70</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Get left edge of a given bar on the visualization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getOffset: <span class="keyword">function</span>(ind){
        <span class="keyword">if</span> (!<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>)) {
            <span class="keyword">return</span> ind * <span class="keyword">this</span>.calcBarWidth();
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)[ind].dateOffset;
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Calculate the inner width of a callout element based in its contents.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getCalloutHeight: <span class="keyword">function</span>(d){
        <span class="keyword">var</span> ret = <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Width of icon + padding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> el_w = <span class="number">29</span>;
        <span class="keyword">if</span> (d.att !== <span class="number">0</span>) { ret += el_w; }
        <span class="keyword">if</span> (d.crit !== <span class="number">0</span>) { ret += el_w; }
        <span class="keyword">if</span> (d.inf !== <span class="number">0</span>) { ret += el_w; }
        <span class="keyword">if</span> (d.perf !== <span class="number">0</span>) { ret += el_w; }
        <span class="keyword">return</span> ret;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Generate an array of callout classification images based on the talk-page
entry that is represented by that callout.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    genCalloutImageSet: <span class="keyword">function</span>(d){
        <span class="keyword">var</span> imgs = [];
        <span class="keyword">if</span> (d.att !== <span class="number">0</span>) { imgs.push(<span class="string">'att'</span>); }
        <span class="keyword">if</span> (d.crit !== <span class="number">0</span>) { imgs.push(<span class="string">'crit'</span>); }
        <span class="keyword">if</span> (d.inf !== <span class="number">0</span>) { imgs.push(<span class="string">'inf'</span>); }
        <span class="keyword">if</span> (d.perf !== <span class="number">0</span>) { imgs.push(<span class="string">'perf'</span>); }
        <span class="keyword">return</span> imgs;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Update the info box using an object composed of prop=&gt;val pairs.
UNUSED for now, but may be able to be adapted into something later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateInfo: <span class="keyword">function</span>(properties) {</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Update the content of the info box.
First, hide the default &#39;no selection&#39; message.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#d_info_noselection'</span>).addClass(<span class="string">'invisible'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Clear any data inside the info div.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#d_info_selection'</span>).empty();
    
        <span class="keyword">var</span> numProps = <span class="number">0</span>;
    
        <span class="keyword">this</span>.$(<span class="string">'#d_info_selection'</span>).append($(<span class="string">'&lt;table&gt;'</span>));
    
        <span class="keyword">for</span> (p <span class="keyword">in</span> properties) {
            <span class="keyword">if</span> (!properties.hasOwnProperty(p)) <span class="keyword">continue</span>;
            ++numProps;
            <span class="keyword">this</span>.$(<span class="string">'#d_info_selection table'</span>).append($(<span class="string">'&lt;tr&gt;'</span>).append($(<span class="string">'&lt;td&gt;'</span>).text(p)).append($(<span class="string">'&lt;td&gt;'</span>).text(properties[p].toString())));
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>If there is no data, display &#39;no selection&#39; message.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (numProps == <span class="number">0</span>) {
            <span class="keyword">this</span>.$(<span class="string">'#d_info_selection'</span>).empty();
            <span class="keyword">this</span>.$(<span class="string">'#d_info_noselection'</span>).removeClass(<span class="string">'invisible'</span>);
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Deletes all of the month rects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clearMonths: <span class="keyword">function</span>() {
        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).body.select(<span class="string">'.bg'</span>).selectAll(<span class="string">'.month'</span>).data([]).exit().remove();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Redraw dots here for talk page entries after changing numDots</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateDots: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).tx.range([<span class="number">0</span>, <span class="keyword">this</span>.calcTalkWidth()]);
        <span class="keyword">if</span> (!<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>)){
            <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).tdata.selectAll(<span class="string">'.tdatum'</span>)
                .attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d, i) { <span class="keyword">return</span> <span class="string">'translate('</span> + <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).tx(i) + <span class="string">', 0)'</span>; }, <span class="keyword">this</span>));
        }
        <span class="keyword">this</span>.buildMonths();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Rescale x-axis based on the number of bars that should fit into a screen after changing numBars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateBars: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).x.range([<span class="number">0</span>, <span class="keyword">this</span>.calcBarWidth()]);
        <span class="keyword">if</span> (!<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>)){
            <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>)
                .attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate('</span> + <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).x(<span class="keyword">this</span>.model.index(d)) + <span class="string">', 0)'</span>; }, <span class="keyword">this</span>));
        }
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).selectAll(<span class="string">'.bars rect'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.calcBarWidth());</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Hide x labels that would overlap!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).select(<span class="string">'.xlabel'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="keyword">this</span>.getBBox().width &lt;= that.calcBarWidth(); })
            .attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).select(<span class="string">'.xlabel'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="keyword">this</span>.getBBox().width &gt; that.calcBarWidth(); })
            .attr(<span class="string">'opacity'</span>, <span class="number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>Need to update the month rectangles so that they use the new scale!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.buildMonths();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Highlight those entries that were made by users in userlist.
TODO: Apply selections to the scroll bar area and to the talk page contributions!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    applyUserSelection: <span class="keyword">function</span>(userlist) {</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Clean up any previous selections!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.clearAllSelections();</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Enable the deselect button if there is an active selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (userlist.length &gt; <span class="number">0</span>) {
            <span class="keyword">this</span>.$(<span class="string">'#t_deselect'</span>).button(<span class="string">'enable'</span>);
        } <span class="keyword">else</span> {
            <span class="keyword">this</span>.clearAllSelections();
            <span class="keyword">return</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Disable the legend selection mechanism</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="string">'#diag_legend input'</span>).attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Disable groups selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="string">'#d_select_groups_accordion input'</span>).attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Update info box.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> info = {};
    
        info[<span class="string">'Number of Selected Users'</span>] = userlist.length;
        info[<span class="string">'User Groups'</span>] = [];
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; userlist.length; ++i) {
            <span class="keyword">if</span> (jQuery.inArray(<span class="keyword">this</span>.model.getGroupsByName(userlist[i]), info[<span class="string">'User Groups'</span>]) == -<span class="number">1</span>) {
                info[<span class="string">'User Groups'</span>].push(<span class="keyword">this</span>.model.getGroupsByName(userlist[i]));
            }
        }
        <span class="keyword">this</span>.updateInfo(info);</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Apply selection to &#39;Content Details&#39; table.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="string">'#diag_data table tbody'</span>).children(<span class="string">'tr'</span>).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, elem)</span> {</span>
            $(elem).removeClass(<span class="string">'rowselect'</span>);
            <span class="keyword">if</span> (jQuery.inArray($(elem).children(<span class="string">':eq(2)'</span>).text(), userlist) != -<span class="number">1</span>) {
                $(elem).addClass(<span class="string">'rowselect'</span>);
            }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Apply selection to the main article contribution view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).filter(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> jQuery.inArray(d.user, userlist) === -<span class="number">1</span>; }).selectAll(<span class="string">'.bars rect'</span>).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">0.2</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Apply selection to nav &quot;spikes&quot;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.navctl.spikes.filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> jQuery.inArray(d.user, userlist) === -<span class="number">1</span>; }).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">0.4</span>);
    
        <span class="keyword">return</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>This is the action that is taken when the user clicks on the &quot;reset selections&quot; button in the toolbar.
It should reset all selection tools to their default states, and enable previously disabled selection tools as necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clearAllSelections: <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Disable the deselect button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#t_deselect'</span>).button(<span class="string">'disable'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Update the info box (UNUSED)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.updateInfo({});</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Clear all selections made in the table view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#diag_data table tbody tr'</span>).each(<span class="function"><span class="keyword">function</span> <span class="params">(i, elem)</span> {</span> $(elem).removeClass(<span class="string">'rowselect'</span>); });</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Pre-check all edit category and user group selection boxes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#d_legend_accordion input'</span>).attr(<span class="string">'checked'</span>, <span class="string">'checked'</span>);
        $(<span class="string">'#d_select_groups_accordion input'</span>).attr(<span class="string">'checked'</span>, <span class="string">'checked'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Update the various views to reflect reset of all selections.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.bars rect'</span>).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Update nav control spikes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.navctl.spikes.transition().duration(<span class="number">500</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Re-enable any previously disabled selection controls</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#diag_legend input'</span>).removeAttr(<span class="string">'disabled'</span>);
        <span class="keyword">this</span>.$(<span class="string">'#d_select_groups_accordion input'</span>).removeAttr(<span class="string">'disabled'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Switch visualization to time-spaced mode, or update time-spaced visualization
This is currently called by the slider element on a switch mode event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toTimeSpaced: <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Re-position all article revision elements using the x axis time scale.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        d3.selectAll(<span class="string">'.datum'</span>)
            .attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) {<span class="keyword">return</span> <span class="string">'translate('</span> + <span class="keyword">this</span>.model.timeX(d.date) + <span class="string">',0)'</span>;}, <span class="keyword">this</span>))
            .selectAll(<span class="string">'.bars rect'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.calcBarWidth());</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Re-position talk page entry callouts using the x-axis time scale.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        d3.selectAll(<span class="string">'.tdatum'</span>)
            .attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) {<span class="keyword">return</span> <span class="string">'translate('</span> + <span class="keyword">this</span>.model.timeX(d.date) + <span class="string">',0)'</span>;}, <span class="keyword">this</span>))</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>Update the month view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.buildMonths();</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Show the month view if we are in TS talk page mode.
This is because the month view is hidden in adj-talk page mode, but we want it for TS anyway.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (<span class="keyword">this</span>.model.get(<span class="string">'mode'</span>) == <span class="string">"talk"</span>) {
            d3.selectAll(<span class="string">'.month'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Switch visualization to adacent-spacing mode
Currently called by the slider element when a mode change event occurs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toAdjacentSpaced: <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Hide the month view if we are in adjacent spacing talk-page mode.
(The month view does not make any sense in this mode)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (<span class="keyword">this</span>.model.get(<span class="string">'mode'</span>) == <span class="string">"talk"</span>) {
            d3.selectAll(<span class="string">'.month'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Re-position all article and talk-page contributions using adjacent-spacing parameters / axes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        d3.selectAll(<span class="string">'.datum'</span>)
            .attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) {<span class="keyword">return</span> <span class="string">'translate('</span> + <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).x(<span class="keyword">this</span>.model.index(d)) + <span class="string">',0)'</span>;}, <span class="keyword">this</span>))
            .selectAll(<span class="string">'.bars rect'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.calcBarWidth());
        
        d3.selectAll(<span class="string">'.tdatum'</span>)
            .attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d, i) {<span class="keyword">return</span> <span class="string">'translate('</span> + <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).tx(i) + <span class="string">',0)'</span>;}, <span class="keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>Update the month view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.buildMonths();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>Function to map revision data to rectangle groups that represent the data as a stacked bar graph.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    buildBars: <span class="keyword">function</span>(barsGroup, barWidth){
        <span class="keyword">var</span> posFields = [<span class="string">'add'</span>, <span class="string">'unsure'</span>, <span class="string">'reorganize'</span>, <span class="string">'edit'</span>, <span class="string">'cite'</span>, <span class="string">'vand'</span>, <span class="string">'unclassified'</span>];
        <span class="keyword">var</span> negFields = [<span class="string">'unvand'</span>, <span class="string">'remove'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>For brevity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> y = <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).y;
        <span class="keyword">var</span> index = <span class="keyword">this</span>.model.index;</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Make array to store partial sums of weighted attributes for each data element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> sums = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>Zero-out array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length; ++i) { sums[i] = <span class="number">0</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>Build up the stacked bars. The sums array stores the sum of the last few stacked values&#39; heights so that we can stack them properly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _.each(posFields, <span class="keyword">function</span>(v, i) {
            barsGroup.filter(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d.wclass[v] &gt; <span class="number">0.0001</span>; }).append(<span class="string">'rect'</span>).attr(<span class="string">'y'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> y(sums[index(d)])*<span class="number">0.85</span>; })
                .attr(<span class="string">'width'</span>, barWidth).attr(<span class="string">'height'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> y(d.wclass[v])*<span class="number">0.85</span>; }).attr(<span class="string">'class'</span>, v)
                .attr(<span class="string">'desc'</span>, index).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Collect the sums of what we&#39;ve seen so far so as to stack the bars properly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> ind = <span class="number">0</span>; ind &lt; <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length; ++ind) { sums[ind] += <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)[ind].wclass[v]; }
        }, <span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>The negatives are done the same way, but we have to change the role of the &#39;y&#39; attribute.</p>
<p>Zero-out array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length; ++i) { sums[i] = <span class="number">0</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Build up the stacked bars. The sums array stores the sum of the last few stacked values&#39; heights so that we can stack them properly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _.each(negFields, <span class="keyword">function</span>(v, i) {
            barsGroup.filter(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d.wclass[v] &gt; <span class="number">0.0001</span>; }).append(<span class="string">'rect'</span>).attr(<span class="string">'y'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> -y(d.wclass[v]+sums[index(d)])*<span class="number">0.85</span>; }).attr(<span class="string">'width'</span>, barWidth)
                .attr(<span class="string">'height'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> y(d.wclass[v])*<span class="number">0.85</span>; }).attr(<span class="string">'class'</span>, v).attr(<span class="string">'desc'</span>, index).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>Collect the sums of what we&#39;ve seen so far so as to stack the bars properly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> ind = <span class="number">0</span>; ind &lt; <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>).length; ++ind) { sums[ind] += <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)[ind].wclass[v]; }
        }, <span class="keyword">this</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>Create or Update month background rects.
These are the shaded rectangles in the background of the visualization that indicate periods of 1 month.
We need to build these to the correct scale so that they line up with the correct revisions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    buildMonths: <span class="function"><span class="keyword">function</span> <span class="params">()</span>{</span>
        <span class="keyword">var</span> barWidth = <span class="keyword">this</span>.calcBarWidth();
        <span class="keyword">var</span> revdata = <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>);
        <span class="keyword">var</span> qualityData = Array();
        <span class="keyword">var</span> eventsData = Array();</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Min. additional width of month box required to display text.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> blankThreshold = <span class="number">10</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Helper.view.body.select(&#39;.bg&#39;).selectAll(&#39;.month&#39;).data([]).exit().remove();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> data = [];
        <span class="keyword">var</span> months = [<span class="string">'Jan'</span>, <span class="string">'Feb'</span>, <span class="string">'Mar'</span>, <span class="string">'Apr'</span>, <span class="string">'May'</span>, <span class="string">'Jun'</span>, <span class="string">'Jul'</span>, <span class="string">'Aug'</span>, <span class="string">'Sep'</span>, <span class="string">'Oct'</span>, <span class="string">'Nov'</span>, <span class="string">'Dec'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>If the visualization is not time spaced, we need to go through our data, find month boundaries, and
build a list of the left and right offsets of the month rects on the visualization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (!<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>)) {
            <span class="keyword">var</span> lastDate = <span class="keyword">new</span> Date(_.first(revdata).timestamp);
            <span class="keyword">var</span> curDate;
            <span class="keyword">var</span> lastIndex = <span class="number">0</span>;
            <span class="keyword">var</span> lastRev = _.first(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>));
            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; revdata.length; ++i) {</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>We need to build width and offset positions for the various month groups
We do this by scanning through our bar graph data and appending to the month data as we go.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                curDate = <span class="keyword">new</span> Date(revdata[i].timestamp);
                
                <span class="keyword">if</span> (curDate.getMonth() !== lastDate.getMonth() || curDate.getYear() !== lastDate.getYear()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>var left = lastIndex <em> barWidth;
var right = (i-1) </em> barWidth;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    
                    <span class="keyword">var</span> left = <span class="keyword">this</span>.getOffset(lastIndex);
                    <span class="keyword">var</span> right = <span class="keyword">this</span>.getOffset(i);
                    <span class="keyword">if</span> (left === right) <span class="keyword">continue</span>;
                    data.push({l: left, r:right, m:lastDate.getMonth(), y:lastDate.getFullYear()});
                    lastDate = curDate;
                    lastIndex = i;
                    _.each(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'quality'</span>), $.proxy(<span class="keyword">function</span>(quality){
                        <span class="keyword">var</span> cutoff = <span class="keyword">new</span> Date(quality.cutoff);
                        <span class="keyword">if</span>(curDate.getMonth() == cutoff.getMonth() &amp;&amp; curDate.getYear() == cutoff.getYear()){
                            qualityData.push({l: <span class="keyword">this</span>.getOffset(lastIndex), q: quality});
                        }
                    }, <span class="keyword">this</span>));
                    _.each(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'events'</span>), $.proxy(<span class="keyword">function</span>(event){
                        <span class="keyword">var</span> time = <span class="keyword">new</span> Date(event.timestamp);
                        <span class="keyword">if</span>(curDate.getMonth() == time.getMonth() &amp;&amp; curDate.getYear() == time.getYear()){
                            eventsData.push({l: <span class="keyword">this</span>.getOffset(lastIndex), e: event});
                        }
                    }, <span class="keyword">this</span>));
                }
            }
        
            <span class="keyword">var</span> left = <span class="keyword">this</span>.getOffset(lastIndex);
            <span class="keyword">var</span> right = <span class="keyword">this</span>.getOffset(revdata.length);
            data.push({l: left, r:right, m:lastDate.getMonth(), y:lastDate.getFullYear()});
        } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>If we ARE in time-separated mode, we need to loop through all the months between the first and last edits
and add them all.
We use the timeX scale to find the left and right boundaries.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> lastMonth;
            <span class="keyword">var</span> first = <span class="literal">true</span>;
            <span class="keyword">var</span> timeX = <span class="keyword">this</span>.model.timeX;
            <span class="keyword">for</span> (<span class="keyword">var</span> m = _.first(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date.getMonth(),
                 y = _.first(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date.getFullYear();
                 m &lt;= _.last(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date.getMonth() || y &lt;= _.last(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date.getFullYear();
                 ++m) {
                <span class="keyword">if</span> (m &gt; <span class="number">11</span>) { m = <span class="number">0</span>; ++y;}
                <span class="keyword">if</span> (first) {
                    <span class="keyword">if</span> (m == <span class="number">0</span>) lastMonth = <span class="keyword">new</span> Date(y - <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>);
                    <span class="keyword">else</span> lastMonth = <span class="keyword">new</span> Date(y, m - <span class="number">1</span>, <span class="number">1</span>);
                    first = <span class="literal">false</span>;
                }
                <span class="keyword">var</span> curMonth = <span class="keyword">new</span> Date(y, m, <span class="number">1</span>);
                data.push({l: timeX(lastMonth), r: timeX(curMonth), m: lastMonth.getMonth(), y: lastMonth.getFullYear()});
                lastMonth = curMonth;
            }
            
            _.each(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'quality'</span>), <span class="keyword">function</span>(quality){
                <span class="keyword">var</span> cutoff = <span class="keyword">new</span> Date(quality.cutoff);
                qualityData.push({l: timeX(cutoff), q: quality});
            });
            _.each(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'events'</span>), <span class="keyword">function</span>(event){
                <span class="keyword">var</span> time = <span class="keyword">new</span> Date(event.timestamp);
                eventsData.push({l: timeX(time), e: event});
            });
        }
    
        <span class="keyword">var</span> bg = <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).body.select(<span class="string">'.bg'</span>);
        
    
        <span class="keyword">var</span> mts_e = bg.selectAll(<span class="string">'.month'</span>).data(data, <span class="keyword">function</span>(d, i) { <span class="keyword">return</span> i; }).enter();
        <span class="keyword">var</span> mts_g = mts_e.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'month'</span>).attr(<span class="string">'transform'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate('</span> + d.l + <span class="string">',0)'</span>; });
        mts_g.append(<span class="string">'rect'</span>).attr(<span class="string">'height'</span>, String(<span class="keyword">this</span>.model.get(<span class="string">'height'</span>))).attr(<span class="string">'width'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> (d.r-d.l); })
            .attr(<span class="string">'class'</span>, <span class="keyword">function</span>(d, i) { <span class="keyword">return</span> (i%<span class="number">2</span> === <span class="number">0</span>)?(<span class="string">'m_odd'</span>):(<span class="string">'m_even'</span>);}).attr(<span class="string">'y'</span>, String(-<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span>));
        mts_g.append(<span class="string">'text'</span>).attr(<span class="string">'class'</span>, <span class="string">'mtext'</span>).text(<span class="keyword">function</span>(d) { <span class="keyword">return</span> months[d.m]; }).attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate(5,'</span> + (<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span> - <span class="number">15</span>) + <span class="string">')scale(1,-1)'</span>;}, <span class="keyword">this</span>)).attr(<span class="string">'opacity'</span>, <span class="number">1</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> ((d.r-d.l) - <span class="keyword">this</span>.getComputedTextLength()) &lt; blankThreshold;}).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        mts_g.append(<span class="string">'text'</span>).attr(<span class="string">'class'</span>, <span class="string">'ytext'</span>).text(<span class="keyword">function</span>(d) { <span class="keyword">return</span> String(d.y); }).attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate(5,'</span> + (<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span> - <span class="number">30</span>) + <span class="string">')scale(1,-1)'</span>;}, <span class="keyword">this</span>)).attr(<span class="string">'opacity'</span>, <span class="number">1</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> ((d.r-d.l) - <span class="keyword">this</span>.getComputedTextLength()) &lt; blankThreshold;}).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
    
        mts = <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).body.selectAll(<span class="string">'.month'</span>).data(data, <span class="keyword">function</span>(d, i) { <span class="keyword">return</span> i; });
        <span class="keyword">var</span> mts_t = mts;
        mts_t.attr(<span class="string">'transform'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate('</span> + d.l + <span class="string">',0)'</span>; });
        mts_t.select(<span class="string">'rect'</span>).attr(<span class="string">'width'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> (d.r-d.l); });;
        mts.select(<span class="string">'text.mtext'</span>).text(<span class="keyword">function</span>(d) { <span class="keyword">return</span> months[d.m]; });
        mts.select(<span class="string">'text.ytext'</span>).text(<span class="keyword">function</span>(d) { <span class="keyword">return</span> String(d.y); });
        mts_t.select(<span class="string">'rect'</span>).attr(<span class="string">'class'</span>, <span class="keyword">function</span>(d, i) { <span class="keyword">return</span> (i%<span class="number">2</span> === <span class="number">0</span>)?(<span class="string">'m_odd'</span>):(<span class="string">'m_even'</span>);});
        mts.select(<span class="string">'text.mtext'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> ((d.r-d.l) - <span class="keyword">this</span>.getComputedTextLength()) &lt; blankThreshold;}).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        mts.select(<span class="string">'text.mtext'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> ((d.r-d.l) - <span class="keyword">this</span>.getComputedTextLength()) &gt;= blankThreshold;}).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        mts.select(<span class="string">'text.ytext'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> ((d.r-d.l) - <span class="keyword">this</span>.getComputedTextLength()) &lt; blankThreshold;}).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        mts.select(<span class="string">'text.ytext'</span>).filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> ((d.r-d.l) - <span class="keyword">this</span>.getComputedTextLength()) &gt;= blankThreshold;}).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
    
        bg.selectAll(<span class="string">'.bar'</span>).remove();
        <span class="keyword">var</span> bar_g = bg.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'bar'</span>);
        bar_g.append(<span class="string">'rect'</span>).attr(<span class="string">'class'</span>, <span class="string">'bar_bg'</span>)
                            .attr(<span class="string">'width'</span>, <span class="string">'100%'</span>)
                            .attr(<span class="string">'height'</span>, <span class="number">35</span>)
                            .attr(<span class="string">'fill'</span>, <span class="string">'#F2E4CB'</span>);
        <span class="keyword">this</span>.repositionBar();
        <span class="keyword">var</span> r = <span class="number">8</span>;
        _.each(qualityData, $.proxy(<span class="keyword">function</span>(d){
            <span class="keyword">var</span> text = <span class="string">"&lt;table&gt;"</span>;
            _.each(d.q.description, <span class="keyword">function</span>(val, i){
                text += <span class="string">"&lt;tr&gt;&lt;td align='right'&gt;"</span> + i + <span class="string">":&amp;nbsp;&lt;/td&gt;&lt;td&gt;"</span> + val + <span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;
            });
            text += <span class="string">"&lt;tr&gt;&lt;td align='right'&gt;Avg Score:&amp;nbsp;&lt;/td&gt;&lt;td&gt;"</span> + d.q.score + <span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;
            
            <span class="keyword">if</span>(d.q.metric == <span class="string">'CoDNA'</span>){
                text += <span class="string">"&lt;tr&gt;&lt;td colspan='2'&gt;&lt;a style='float:right;' href='http://dl.acm.org/citation.cfm?id=2069609' target='_blank'&gt;Source&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;"</span>;
            }
            text += <span class="string">"&lt;/table&gt;"</span>;
            <span class="keyword">var</span> clone = $(_.template($(<span class="string">"#tooltip_template"</span>).html(), {
                title: d.q.metric + <span class="string">" Ranking"</span>,
                text: text
            }));
            <span class="keyword">this</span>.$(<span class="string">'#view'</span>).append(clone);
            bar_g.append(<span class="string">'circle'</span>).attr(<span class="string">'r'</span>, r)
                                  .attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (d.l) + <span class="string">',-'</span> + (<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span> - r*<span class="number">2</span>) + <span class="string">')'</span>)
                                  .attr(<span class="string">'fill'</span>, <span class="string">'#2C5C7D'</span>);
            $(<span class="string">".bar circle"</span>).last().click($.proxy(<span class="keyword">function</span>(){
                _.defer($.proxy(<span class="keyword">function</span>(){
                    $(<span class="string">".tooltip"</span>).not(clone).fadeOut();
                    clone.fadeToggle();
                    <span class="keyword">var</span> height = $(clone[<span class="number">1</span>]).height();
                    clone.css(<span class="string">'left'</span>, <span class="keyword">this</span>.mouseX + r*<span class="number">2</span>)
                         .css(<span class="string">'top'</span>, <span class="keyword">this</span>.mouseY - r*<span class="number">2</span> - height);
                }, <span class="keyword">this</span>));
            }, <span class="keyword">this</span>));
        }, <span class="keyword">this</span>));
        _.each(eventsData, $.proxy(<span class="keyword">function</span>(d){
            <span class="keyword">var</span> clone = $(_.template($(<span class="string">"#tooltip_template"</span>).html(), {
                title: d.e.title,
                text: d.e.description + <span class="string">"&lt;br /&gt;Date:&amp;nbsp;"</span> + Helper.formatDate(<span class="keyword">new</span> Date(d.e.timestamp), <span class="literal">false</span>),
            }));
            <span class="keyword">this</span>.$(<span class="string">'#view'</span>).append(clone);
            bar_g.append(<span class="string">'circle'</span>).attr(<span class="string">'r'</span>, r)
                                  .attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (d.l) + <span class="string">',-'</span> + (<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span> - r*<span class="number">2</span>) + <span class="string">')'</span>)
                                  .attr(<span class="string">'fill'</span>, <span class="string">'#8B2C0D'</span>);
            $(<span class="string">".bar circle"</span>).last().click($.proxy(<span class="keyword">function</span>(){
                _.defer($.proxy(<span class="keyword">function</span>(){
                    $(<span class="string">".tooltip"</span>).not(clone).fadeOut();
                    clone.fadeToggle();
                    <span class="keyword">var</span> height = $(clone[<span class="number">1</span>]).height();
                    clone.css(<span class="string">'left'</span>, <span class="keyword">this</span>.mouseX + r*<span class="number">2</span>)
                         .css(<span class="string">'top'</span>, <span class="keyword">this</span>.mouseY - r*<span class="number">2</span> - height);
                }, <span class="keyword">this</span>));
            }, <span class="keyword">this</span>));
        }, <span class="keyword">this</span>));
    
        <span class="keyword">var</span> mts_x = mts.exit();
        mts_x.attr(<span class="string">'opacity'</span>, <span class="number">0</span>).remove();
    },
    
    repositionBar: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$(<span class="string">".tooltip"</span>).hide();
        <span class="keyword">var</span> bg = <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).body.select(<span class="string">'.bg'</span>);
        <span class="keyword">var</span> bar_g = bg.selectAll(<span class="string">'.bar_bg'</span>);
        bar_g.attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + <span class="keyword">this</span>.navctl.getPanOffset() + <span class="string">',-'</span> + (<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span>) + <span class="string">')'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>Append the callouts that correspond to the talk-page entries for our article to the given element.
Note that the argument &#39;parent&#39; should be a d3 selection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    appendCallout: <span class="keyword">function</span>(parent){
        <span class="keyword">var</span> cw = <span class="number">24</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>Padding around content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> px = <span class="number">10</span>;
        <span class="keyword">var</span> py = <span class="number">10</span>;
        <span class="keyword">var</span> ox = <span class="number">10</span>;
        <span class="keyword">var</span> oy = <span class="number">10</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>Corner radius in px</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> cr = <span class="number">5</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>Max circle radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> maxR = <span class="number">10</span>;
        <span class="keyword">var</span> fact = <span class="number">1.2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>Append circle to our element. Cap the circle size and re-style the circle if it has reached the cap.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        parent.filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> Math.log(d.lev+<span class="number">1</span>)*fact &lt;= maxR; }).append(<span class="string">'circle'</span>).attr(<span class="string">'r'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> Math.log(d.lev+<span class="number">1</span>)*fact; }).attr(<span class="string">'class'</span>, <span class="string">'tcircle'</span>);
        parent.filter(<span class="keyword">function</span>(d) { <span class="keyword">return</span> Math.log(d.lev+<span class="number">1</span>)*fact &gt; maxR; }).append(<span class="string">'circle'</span>).attr(<span class="string">'r'</span>, maxR).attr(<span class="string">'class'</span>, <span class="string">'tcircle_full'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>Generate the tooltip for this element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        parent.append(<span class="string">'title'</span>).text(<span class="keyword">function</span>(d) {
            <span class="keyword">return</span> <span class="string">'User: '</span> + d.contributor + <span class="string">'\n'</span> + Helper.formatDate(d.date) + <span class="string">'\n'</span> + <span class="string">'Revision Categories: '</span> + Helper.toTalkClassString(d) + <span class="string">'\n'</span> + <span class="string">'Revision Size: '</span> + d.lev;
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>Generate the path that defines the shape of the callout.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> callout = parent.append(<span class="string">'path'</span>);
        callout.attr(<span class="string">'d'</span>, $.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">"M 0 0 l {0} {1} l 0 {2} a {3} {3} 0 0 0 {3} {3} l {4} 0 a {3} {3} 0 0 0 {3} -{3} l 0 -{5} a {3} {3} 0 0 0 -{3} -{3} l -{6} 0 z"</span>.format(</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>Coords of left bottom of callout &quot;box&quot; rel. to &quot;origin&quot;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ox, oy,
            <span class="keyword">this</span>.getCalloutHeight(d) + <span class="number">2</span>*px - <span class="number">2</span>*cr,</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>Corner radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            cr,
            cw + <span class="number">2</span>*py - cr,
            <span class="keyword">this</span>.getCalloutHeight(d) + <span class="number">2</span>*px - cr - <span class="number">10</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>Last number here is the width of the wide-end of the callout triangle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            cw + <span class="number">2</span>*py - <span class="number">2</span>*cr
        )}, <span class="keyword">this</span>));
        callout.attr(<span class="string">'class'</span>, <span class="string">'callout'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>Generate the x-offset for each callout incrementally.
This is used in adjacent spacing of callouts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> x = <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>Create image groups based on talk-page classifications and append these image groups to their respective callouts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> igroup = parent.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'igroup'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (ox+px) + <span class="string">','</span> + (oy+py) +<span class="string">')scale(1,-1)'</span>).datum($.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="keyword">this</span>.genCalloutImageSet(d); }, <span class="keyword">this</span>));
        igroup.each(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span>
            d3.select(<span class="keyword">this</span>).selectAll(<span class="string">'image'</span>).data(d).enter().append(<span class="string">'image'</span>).attr(<span class="string">'xlink:href'</span>, <span class="keyword">function</span>(dm) { <span class="keyword">return</span> <span class="string">"img/"</span> + dm + <span class="string">".png"</span>; }).attr(<span class="string">'y'</span>, <span class="keyword">function</span>(dm, i) { <span class="keyword">return</span> -<span class="number">29</span>*i-<span class="number">24</span>; })
                .attr(<span class="string">'width'</span>, <span class="number">24</span>).attr(<span class="string">'height'</span>, <span class="number">24</span>).attr(<span class="string">'x'</span>, <span class="number">3</span>).attr(<span class="string">'class'</span>, <span class="keyword">function</span>(dm) { <span class="keyword">return</span> dm; } );
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>Append to each callout an x-axis label corresponding to its ID.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        parent.append(<span class="string">'text'</span>).attr(<span class="string">'class'</span>, <span class="string">'xlabel'</span>).text(<span class="keyword">function</span>(d, i) { <span class="keyword">return</span> i + <span class="number">1</span>; })
            .attr(<span class="string">'transform'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate('</span> + (ox+px/<span class="number">2</span>) + <span class="string">','</span> + (oy+py/<span class="number">2</span>) + <span class="string">')scale(1,-1)'</span>; });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>Updates the view based on whether or not the view is set to time spaced or adjacent spaced</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateSpacing: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>)){
            <span class="keyword">this</span>.navctl.toTimeSpaced();
            <span class="keyword">this</span>.toTimeSpaced();
        } <span class="keyword">else</span> {
            <span class="keyword">this</span>.navctl.toAdjacentSpaced();
            <span class="keyword">this</span>.toAdjacentSpaced();
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>Updates the view based on the type of mode it is in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateMode: <span class="keyword">function</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'mode'</span>) == <span class="string">'art'</span>){
            <span class="keyword">this</span>.$(<span class="string">'#view'</span>).appendTo(<span class="keyword">this</span>.$(<span class="string">'#artview'</span>));
            <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            d3.selectAll(<span class="string">'.sd'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            d3.selectAll(<span class="string">'.tdatum'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
            d3.selectAll(<span class="string">'.tcircle'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        
            <span class="keyword">this</span>.$(<span class="string">'#t_legend'</span>).button(<span class="string">'enable'</span>);
            <span class="keyword">this</span>.$(<span class="string">'#t_talk'</span>).button(<span class="string">'disable'</span>);
        
            <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'enable'</span>);
        
            d3.selectAll(<span class="string">'.month'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        
            <span class="keyword">if</span> (<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>) === <span class="literal">false</span>) {
                <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'disable'</span>);
                <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button(<span class="string">'enable'</span>);
                <span class="keyword">this</span>.navctl.toAdjacentSpaced();
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'enable'</span>);
                <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button(<span class="string">'disable'</span>);
                <span class="keyword">this</span>.navctl.toTimeSpaced();
            }
            
            <span class="keyword">this</span>.navctl.onScale();
        
            <span class="keyword">this</span>.$(<span class="string">'.talkrow'</span>).addClass(<span class="string">'invisible'</span>);
            <span class="keyword">this</span>.$(<span class="string">'.defaultrow'</span>).removeClass(<span class="string">'invisible'</span>);
        
            d3.select(<span class="keyword">this</span>.$(<span class="string">'.fg'</span>)[<span class="number">0</span>]).attr(<span class="string">'transform'</span>, <span class="string">'translate(0, -500)'</span>);
        
            d3.selectAll(<span class="string">'g.ylabel'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'mode'</span>) == <span class="string">'talk'</span>){
            <span class="keyword">this</span>.$(<span class="string">'#view'</span>).appendTo(<span class="keyword">this</span>.$(<span class="string">'#talkview'</span>));
            <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
            d3.selectAll(<span class="string">'.sd'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
            d3.selectAll(<span class="string">'.tdatum'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            d3.selectAll(<span class="string">'.tcircle'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        
            $(<span class="string">'#t_legend'</span>).button(<span class="string">'disable'</span>);
            $(<span class="string">'#t_talk'</span>).button(<span class="string">'enable'</span>);
        
            <span class="keyword">if</span> (<span class="keyword">this</span>.model.get(<span class="string">'isTimeSpaced'</span>) === <span class="literal">false</span>) {
                d3.selectAll(<span class="string">'.month'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
                <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'disable'</span>);
                <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button(<span class="string">'enable'</span>);
                <span class="keyword">this</span>.navctl.toAdjacentSpaced();
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'enable'</span>);
                <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button(<span class="string">'disable'</span>);
                <span class="keyword">this</span>.navctl.toTimeSpaced();
            }
        
            <span class="keyword">this</span>.navctl.onScale();
        
            <span class="keyword">this</span>.$(<span class="string">'.talkrow'</span>).removeClass(<span class="string">'invisible'</span>);
            <span class="keyword">this</span>.$(<span class="string">'.defaultrow'</span>).addClass(<span class="string">'invisible'</span>);
        
            d3.select(<span class="keyword">this</span>.$(<span class="string">'.fg'</span>)[<span class="number">0</span>]).attr(<span class="string">'transform'</span>, <span class="string">'translate(0, 0)'</span>);
        
            d3.selectAll(<span class="string">'g.ylabel'</span>).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'mode'</span>) == <span class="string">'hybrid'</span>){
            <span class="keyword">this</span>.$(<span class="string">'#view'</span>).appendTo(<span class="keyword">this</span>.$(<span class="string">'#hybridview'</span>));
            <span class="keyword">this</span>.model.get(<span class="string">'view'</span>).data.selectAll(<span class="string">'.datum'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            d3.selectAll(<span class="string">'.sd'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            d3.selectAll(<span class="string">'.tdatum'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
            d3.selectAll(<span class="string">'.tcircle'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        
            <span class="keyword">this</span>.$(<span class="string">'#t_legend'</span>).button(<span class="string">'enable'</span>);
            <span class="keyword">this</span>.$(<span class="string">'#t_talk'</span>).button(<span class="string">'enable'</span>);
        
            <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'disable'</span>);
            <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button(<span class="string">'disable'</span>);

            <span class="keyword">this</span>.model.set(<span class="string">'isTimeSpaced'</span>, <span class="literal">true</span>);
        
            d3.selectAll(<span class="string">'.month'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        
            <span class="keyword">this</span>.$(<span class="string">'.talkrow'</span>).removeClass(<span class="string">'invisible'</span>);
            <span class="keyword">this</span>.$(<span class="string">'.defaultrow'</span>).removeClass(<span class="string">'invisible'</span>);
        
            d3.select(<span class="keyword">this</span>.$(<span class="string">'.fg'</span>)[<span class="number">0</span>]).attr(<span class="string">'transform'</span>, <span class="string">'translate(0, 0)'</span>);
            d3.selectAll(<span class="string">'g.ylabel'</span>).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>Init visualization with a given article.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    init: <span class="keyword">function</span>(art_title) {
        <span class="keyword">this</span>.$(<span class="string">'#viewtabs'</span>).tabs();
        <span class="keyword">this</span>.model.set(<span class="string">'width'</span>, <span class="keyword">this</span>.$(<span class="string">"#view"</span>).width(), {silent: <span class="literal">true</span>});
        <span class="keyword">this</span>.model.set(<span class="string">'height'</span>, <span class="keyword">this</span>.$(<span class="string">"#view"</span>).height(), {silent: <span class="literal">true</span>});
        <span class="keyword">this</span>.$(<span class="string">'.spacing_wrapper'</span>).mouseenter(<span class="keyword">function</span>() {
            $(<span class="keyword">this</span>).css(<span class="string">'opacity'</span>, <span class="number">1</span>);
        }).mouseleave(<span class="keyword">function</span>() {
            $(<span class="keyword">this</span>).css(<span class="string">'opacity'</span>, <span class="number">0.8</span>);
        });
    
        <span class="keyword">this</span>.model.set(<span class="string">'isTimeSpaced'</span>, <span class="literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>TODO: Move this code to a more appropriate place?</p>

            </div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>Program the &#39;to adjacent spacing&#39; and &#39;to time spacing&#39; mode buttons with
appropriate functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button().attr(<span class="string">'title'</span>, <span class="string">'Adjacent Spacing'</span>);
        <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button().attr(<span class="string">'title'</span>, <span class="string">'Time Spacing'</span>);
    
        <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).click($.proxy(<span class="keyword">function</span>() {
            <span class="keyword">this</span>.model.set(<span class="string">'isTimeSpaced'</span>, <span class="literal">false</span>);
            <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'disable'</span>);
            <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button(<span class="string">'enable'</span>);
        }, <span class="keyword">this</span>));
        <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).click($.proxy(<span class="keyword">function</span>() {
            <span class="keyword">this</span>.model.set(<span class="string">'isTimeSpaced'</span>, <span class="literal">true</span>);
            <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'enable'</span>);
            <span class="keyword">this</span>.$(<span class="string">'#toTime'</span>).button(<span class="string">'disable'</span>);
        }, <span class="keyword">this</span>));
    
        <span class="keyword">this</span>.$(<span class="string">'a[href=#artview]'</span>).click($.proxy(<span class="keyword">function</span>(event, ui) {
            <span class="keyword">this</span>.model.set(<span class="string">'mode'</span>, <span class="string">'art'</span>);
        }, <span class="keyword">this</span>));
        <span class="keyword">this</span>.$(<span class="string">'a[href=#talkview]'</span>).click($.proxy(<span class="keyword">function</span>(event, ui) {
            <span class="keyword">this</span>.model.set(<span class="string">'mode'</span>, <span class="string">'talk'</span>);
        }, <span class="keyword">this</span>));
        <span class="keyword">this</span>.$(<span class="string">'a[href=#hybridview]'</span>).click($.proxy(<span class="keyword">function</span>(event, ui) {
            <span class="keyword">this</span>.model.set(<span class="string">'mode'</span>, <span class="string">'hybrid'</span>);
        }, <span class="keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>In the default configuration, we are already in adjacent spacing mode, so we can disable the adjacent spacing button.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#toAdj'</span>).button(<span class="string">'disable'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>Initialize the visualization. Create SVG and elements correspondng to data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initViz: <span class="keyword">function</span>(){
        <span class="keyword">this</span>.$(<span class="string">'#view svg'</span>).remove();
        <span class="keyword">if</span>(<span class="keyword">this</span>.model.get(<span class="string">'title'</span>) == <span class="string">""</span> &amp;&amp; <span class="keyword">this</span>.model.get(<span class="string">'user'</span>) == <span class="string">""</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>Entry doesn&#39;t exist, don&#39;t go any further otherwise things will break</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">return</span>;
        }
        <span class="comment">/*var title = "";
        if(this.model.get('title') != ""){
            title = this.model.get('title');
        }
        else if(this.model.get('user') != ""){
            title = this.model.get('user');
        }*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>For brevity</p>
<p>Width of mask over which y label is written</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> maskWidth = <span class="keyword">this</span>.model.get(<span class="string">'maskWidth'</span>);
        <span class="keyword">var</span> view = <span class="keyword">this</span>.model.get(<span class="string">'view'</span>);
        view.svg = d3.select(<span class="keyword">this</span>.$(<span class="string">'#view'</span>)[<span class="number">0</span>]).append(<span class="string">'svg'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.model.get(<span class="string">'width'</span>)).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.model.get(<span class="string">'height'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Re-arrange coordinate system by setting x=0 to the center of the SVG and flipping the y-axis values.
Also, set y=0 offset by maskWidth to the left to simplify math regarding the position of the y-axis title and masking rect.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.sview = view.svg.append(<span class="string">'g'</span>).attr(<span class="string">'width'</span>, <span class="keyword">this</span>.model.get(<span class="string">'width'</span>)).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (maskWidth) + <span class="string">','</span> + (<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span>) + <span class="string">')scale(1,-1)'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>Init the x and y scale objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.x = d3.scale.linear();
        view.y = d3.scale.linear();</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>For adjancent talk pages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.tx = d3.scale.linear();
        view.ty = d3.scale.linear();</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>Must take into account the mask width here!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> barWidth = <span class="keyword">this</span>.calcBarWidth();</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>Set up x and y ranges for the visualization. The x-range is designed so that x(n) gives the x-position of the nth bar&#39;s left edge.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.x.range([<span class="number">0</span>, barWidth]);</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>Leave a little bit of room.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.y.range([<span class="number">0</span>, <span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span> - <span class="number">50</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>Y domain determined using largest magnitude y-value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.y.domain([<span class="number">0</span>, Helper.absMax(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>), <span class="keyword">function</span>(elem) { <span class="keyword">return</span> elem.loglev; })]);</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>Group to contain horizontal rules for the visualization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.rules = view.sview.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'rules'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>Positive and negative horizontal rules groups.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> posrules = view.rules.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'posrules'</span>);
        <span class="keyword">var</span> negrules = view.rules.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'negrules'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>Generate actual rules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        posrules.selectAll(<span class="string">'g.rule'</span>).data(view.y.ticks(<span class="number">5</span>)).enter().append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'rule'</span>).attr(<span class="string">'transform'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate(0,'</span> + view.y(d) + <span class="string">')'</span>; });
        negrules.selectAll(<span class="string">'g.rule'</span>).data(view.y.ticks(<span class="number">5</span>)).enter().append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'rule'</span>).attr(<span class="string">'transform'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate(0,'</span> + (-view.y(d)) + <span class="string">')'</span>; });</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>Append lines to rules (i.e. visual representation of rules)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.rules.selectAll(<span class="string">'.rule'</span>).append(<span class="string">'line'</span>).attr(<span class="string">'x2'</span>, Helper.width);</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>Append visualization body group. This group contains the actual visualization. By transforming this group, we transform all the bars and annotations of the visualization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.body = view.sview.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'body'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate(0,0)'</span>);
    
        <span class="keyword">var</span> body = view.body;</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>Append x-axis</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.sview.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'xaxis'</span>).append(<span class="string">'line'</span>).attr(<span class="string">'x2'</span>, <span class="keyword">this</span>.model.get(<span class="string">'width'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>Y-label and mask group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> ylabel = view.sview.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'ylabel'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>Append mask for y-label</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ylabel.append(<span class="string">'rect'</span>).attr(<span class="string">'class'</span>, <span class="string">'ymask'</span>).attr(<span class="string">'width'</span>, maskWidth).attr(<span class="string">'height'</span>, <span class="keyword">this</span>.model.get(<span class="string">'height'</span>)).attr(<span class="string">'y'</span>, -<span class="keyword">this</span>.model.get(<span class="string">'height'</span>)/<span class="number">2</span>).attr(<span class="string">'x'</span>, -maskWidth);</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>Append y-label string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ylabel.append(<span class="string">'text'</span>).attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + -(maskWidth-<span class="number">10</span>) + <span class="string">', 0)rotate(90, 0, 0)scale(1, -1)'</span>).text(<span class="string">'Revision Size'</span>);
        <span class="keyword">var</span> poslabels = ylabel.append(<span class="string">'g'</span>);
        poslabels.selectAll(<span class="string">'.yl'</span>).data(view.y.ticks(<span class="number">5</span>)).enter().append(<span class="string">'text'</span>).attr(<span class="string">'class'</span>, <span class="string">'yl'</span>)
            .attr(<span class="string">'transform'</span>, <span class="keyword">function</span>(d, i) { <span class="keyword">return</span> <span class="string">'translate(-8,'</span> + (view.y(d)) + <span class="string">')scale(1,-1)'</span> }).text(<span class="keyword">function</span>(d, i) {<span class="keyword">return</span> (Math.exp(d)-<span class="number">1</span>).toPrecision(<span class="number">3</span>);});
        <span class="keyword">var</span> neglabels = ylabel.append(<span class="string">'g'</span>);
        neglabels.selectAll(<span class="string">'.yl'</span>).data(view.y.ticks(<span class="number">5</span>)).enter().append(<span class="string">'text'</span>).attr(<span class="string">'class'</span>, <span class="string">'yl'</span>)
            .attr(<span class="string">'transform'</span>, <span class="keyword">function</span>(d, i) { <span class="keyword">return</span> <span class="string">'translate(-8,'</span> + (-view.y(d)) + <span class="string">')scale(1,-1)'</span> }).text(<span class="keyword">function</span>(d, i) {<span class="keyword">return</span> (-Math.exp(d)+<span class="number">1</span>).toPrecision(<span class="number">3</span>);});</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>Set up layers for the body</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        body.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'bg'</span>);
        body.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'mid'</span>);
        body.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'fg'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>Create a group for the article revision datum elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.data = body.select(<span class="string">'g.mid'</span>).append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'data'</span>);
        <span class="keyword">var</span> data = view.data;
    
        <span class="keyword">var</span> datum = data.selectAll(<span class="string">'.datum'</span>).data(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).enter().append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'datum'</span>).attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate('</span> + view.x(<span class="keyword">this</span>.model.index(d)) + <span class="string">', 0)'</span>; }, <span class="keyword">this</span>)).attr(<span class="string">'opacity'</span>, <span class="number">1</span>);
        datum.append(<span class="string">'title'</span>).text(<span class="keyword">function</span>(d) {
            <span class="keyword">return</span> d.group + <span class="string">': '</span> + d.user + <span class="string">'\n'</span> + Helper.formatDate(<span class="keyword">new</span> Date(d.timestamp)) + <span class="string">'\n'</span> + <span class="string">'Revision Categories: '</span> + Helper.toClassString(d.class) + <span class="string">'\n'</span> + <span class="string">'Revision Size: '</span> + d.lev;
        });
        <span class="keyword">var</span> bars = datum.append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'bars'</span>);
        <span class="keyword">this</span>.buildBars(bars, barWidth);
        datum.append(<span class="string">'text'</span>).attr(<span class="string">'class'</span>, <span class="string">'xlabel'</span>).text($.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="number">1</span>+<span class="keyword">this</span>.model.index(d); }, <span class="keyword">this</span>))
            .attr(<span class="string">'transform'</span>, <span class="keyword">function</span>() { <span class="keyword">return</span> <span class="string">'translate(0,'</span> + String(-<span class="number">7</span>) + <span class="string">')scale(1,-1)rotate(90,0,0)'</span>; });
        <span class="keyword">this</span>.buildMonths();</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>Group for talk page data entries</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        view.tdata = body.select(<span class="string">'g.fg'</span>).append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'tdata'</span>);
        <span class="keyword">var</span> tentries = view.tdata.selectAll(<span class="string">'.tdatum'</span>).data(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>)).enter().append(<span class="string">'g'</span>).attr(<span class="string">'class'</span>, <span class="string">'tdatum'</span>)
            .attr(<span class="string">'transform'</span>, $.proxy(<span class="keyword">function</span>(d) { <span class="keyword">return</span> <span class="string">'translate('</span> + view.x(<span class="keyword">this</span>.model.index(d)) + <span class="string">', 0)'</span>; }, <span class="keyword">this</span>)).attr(<span class="string">'opacity'</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.appendCallout(tentries);</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>this.model.set(&#39;isTimeSpaced&#39;, false);</p>

            </div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>Init the timeX scale with the min and max dates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> minDate = _.first(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date;
        <span class="keyword">this</span>.model.timeX.domain([<span class="keyword">new</span> Date(minDate.getFullYear(), minDate.getMonth()),
                       _.last(<span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>)).date]);</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>Apply default range to scale</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.model.timeX.range([<span class="number">0</span>, <span class="number">5000</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <p>Remove &quot;loading&quot; message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$(<span class="string">'#view #view_loading'</span>).remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>Init the navigation control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.navctl.init(<span class="keyword">this</span>.$(<span class="string">'#navctl'</span>).width(), <span class="number">30</span>);
        
        <span class="keyword">var</span> dialog = <span class="literal">null</span>;
        <span class="keyword">if</span>(<span class="keyword">this</span>.view.subviews.toolbar.subviews.diag_select != <span class="literal">undefined</span>){
            dialog = <span class="keyword">this</span>.view.subviews.toolbar.subviews.diag_select.dialog;</pre></div></div>
            
        </li>
        
        
        <li id="section-231">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-231">&#182;</a>
              </div>
              <p>Populate user list in the &#39;select users&#39; dialog.
TODO: Use the values from ownership_results instead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> userMap = {};
            <span class="keyword">var</span> revdata = <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>);
            <span class="keyword">var</span> totalLev = <span class="number">0</span>;
            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; revdata.length; ++i) {
                <span class="keyword">if</span> (!userMap.hasOwnProperty(revdata[i].user)) userMap[revdata[i].user] = <span class="number">0</span>;
                userMap[revdata[i].user] += parseInt(revdata[i].lev);
                totalLev += parseInt(revdata[i].lev);
            }
            <span class="keyword">var</span> users = Array();
            <span class="keyword">for</span> (u <span class="keyword">in</span> userMap) {
                <span class="keyword">if</span> (!userMap.hasOwnProperty(u)) <span class="keyword">continue</span>;
                users.push([u, userMap[u] / totalLev]);
            }

            users.sort(<span class="keyword">function</span>(a, b) {</pre></div></div>
            
        </li>
        
        
        <li id="section-232">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-232">&#182;</a>
              </div>
              <p>Sort by contribution magnitude, descending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">return</span> b[<span class="number">1</span>]-a[<span class="number">1</span>];
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-233">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-233">&#182;</a>
              </div>
              <p>Use d3 to populate the select element in the select users dialog with option elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            d3.select($(<span class="string">'#userselect'</span>, dialog)[<span class="number">0</span>]).selectAll(<span class="string">'option'</span>).data(users).enter().append(<span class="string">'option'</span>).attr(<span class="string">'value'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> d[<span class="number">0</span>]; }).text(<span class="keyword">function</span>(d) {
                <span class="keyword">var</span> percent = d[<span class="number">1</span>]*<span class="number">100</span>;
                <span class="keyword">return</span> d[<span class="number">0</span>] + <span class="string">" ("</span> + percent.toFixed(<span class="number">2</span>).toString() + <span class="string">"%)"</span>;
            });
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.view.subviews.toolbar.subviews.diag_articles != <span class="literal">undefined</span>){
            dialog = <span class="keyword">this</span>.view.subviews.toolbar.subviews.diag_articles.dialog;
            <span class="keyword">var</span> articles = <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'articles'</span>);
            d3.select($(<span class="string">'#userselect'</span>, dialog)[<span class="number">0</span>]).selectAll(<span class="string">'option'</span>).data(articles).enter().append(<span class="string">'option'</span>).attr(<span class="string">'value'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> d; }).text(<span class="keyword">function</span>(d) {
                <span class="keyword">return</span> d;
            });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-234">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-234">&#182;</a>
              </div>
              <p>Clicking on one of the option elements should deselect all checkboxes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="string">'#userselect option'</span>, dialog).click(<span class="keyword">function</span>() {
            $(<span class="string">'input[name=userclassselect]'</span>, dialog).each(<span class="keyword">function</span>() {
                $(<span class="keyword">this</span>).attr(<span class="string">'checked'</span>, <span class="literal">false</span>);
            });
        });
        
        dialog = <span class="keyword">this</span>.view.subviews.toolbar.subviews.diag_data.dialog;
        $(dialog).empty();</pre></div></div>
            
        </li>
        
        
        <li id="section-235">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-235">&#182;</a>
              </div>
              <p>Use d3 to populate the &quot;Content Details&quot; dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> dtable = d3.select(dialog[<span class="number">0</span>]).append(<span class="string">'table'</span>).attr(<span class="string">'class'</span>, <span class="string">'sortable'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-236">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-236">&#182;</a>
              </div>
              <p>Need to specify CSS classes for sorttable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dtable.append(<span class="string">'thead'</span>).append(<span class="string">'tr'</span>).selectAll(<span class="string">'th'</span>).data([</pre></div></div>
            
        </li>
        
        
        <li id="section-237">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-237">&#182;</a>
              </div>
              <p>[&#39;Rev. Type&#39;, &#39;sorttable_alpha&#39;],</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            [<span class="string">'Revision Id'</span>, <span class="string">'sorttable_numeric'</span>],
            [<span class="string">'User'</span>, <span class="string">'sorttable_alpha'</span>],
            [<span class="string">'User Group'</span>, <span class="string">'sorttable_alpha'</span>],
            [<span class="string">'Revision Date'</span>, <span class="string">'sorttable_alpha'</span>],
            [<span class="string">'Revision Size'</span>, <span class="string">'sorttable_numeric'</span>],
            [<span class="string">'Revision Categories'</span>, <span class="string">'sorttable_alpha'</span>],
            ])
            .enter().append(<span class="string">'th'</span>).text(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d[<span class="number">0</span>]; }).attr(<span class="string">'class'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d[<span class="number">1</span>]; });</pre></div></div>
            
        </li>
        
        
        <li id="section-238">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-238">&#182;</a>
              </div>
              <p>Merge article and talk page revision data for the table.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> i=<span class="number">0</span>;
        <span class="keyword">var</span> j=<span class="number">0</span>;
        <span class="keyword">var</span> revs = <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'revisions'</span>);
        <span class="keyword">var</span> tlk = <span class="keyword">this</span>.model.get(<span class="string">'data'</span>).get(<span class="string">'talk'</span>);
        tlk = tlk.sort(<span class="function"><span class="keyword">function</span> <span class="params">(l,r)</span> {</span>
            <span class="keyword">if</span> (l.date == r.date) <span class="keyword">return</span> <span class="number">0</span>;
            <span class="keyword">return</span> (l.date &gt; r.date)? <span class="number">1</span>:-<span class="number">1</span>;
        });
        revs = revs.sort(<span class="function"><span class="keyword">function</span> <span class="params">(l,r)</span> {</span>
            <span class="keyword">if</span> (l.date == r.date) <span class="keyword">return</span> <span class="number">0</span>;
            <span class="keyword">return</span> (l.date &gt; r.date)? <span class="number">1</span>:-<span class="number">1</span>;
        });
        <span class="keyword">var</span> mdata = [];
        <span class="keyword">while</span> (i &lt; revs.length &amp;&amp; j &lt; tlk.length) {
            <span class="keyword">if</span> (revs[i].date &lt; tlk[j].date) {
                mdata.push(revs[i]);
                ++i;
            } <span class="keyword">else</span> {
                mdata.push(tlk[j]);
                ++j;
            }
        }
        <span class="keyword">if</span> (i &lt; revs.length) {
            mdata = mdata.concat(revs.slice(i));
        }
        <span class="keyword">if</span> (j &lt; tlk.length) {
            mdata = mdata.concat(tlk.slice(j));
        }
        
        <span class="keyword">var</span> rows = dtable.append(<span class="string">'tbody'</span>).selectAll(<span class="string">'tr.data'</span>).data(mdata).enter().append(<span class="string">'tr'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-239">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-239">&#182;</a>
              </div>
              <p>rows.append(&#39;td&#39;).text(function(d) {
return (d.type === &#39;art&#39;)?(&#39;A&#39;):(&#39;TP&#39;);
});
rows.append(&#39;td&#39;).text(function(d) { return 1+d.id; });</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        rows.append(<span class="string">'td'</span>).text(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d.revid; });
        rows.append(<span class="string">'td'</span>).text(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d.user; });
        rows.append(<span class="string">'td'</span>).text(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d.group; });
        rows.append(<span class="string">'td'</span>).text(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> Helper.formatDate(d.date); })
            .attr(<span class="string">'sorttable_customkey'</span>, <span class="keyword">function</span>(d) { <span class="keyword">return</span> Helper.getDateSortKey(d.date); });
        rows.append(<span class="string">'td'</span>).text(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d.lev; });
        rows.append(<span class="string">'td'</span>).text(<span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span>
            <span class="keyword">if</span> (d.type === <span class="string">'art'</span>) {
                <span class="keyword">return</span> Helper.toClassString(d.class);
            } <span class="keyword">else</span> <span class="keyword">if</span> (d.type === <span class="string">'talk'</span>) {
                <span class="keyword">return</span> Helper.toTalkClassString(d);
            } <span class="keyword">else</span> {
                <span class="keyword">return</span> <span class="string">'Undefined'</span>;
            }
        });
        rows.attr(<span class="string">'class'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span>
            <span class="keyword">if</span> (d.type === <span class="string">'talk'</span>) <span class="keyword">return</span> <span class="string">'data talkrow'</span>;
            <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">'data defaultrow'</span>;
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-240">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-240">&#182;</a>
              </div>
              <p>Get the sorttable library to make this table sortable!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        sorttable.makeSortable($(<span class="string">'table.sortable'</span>, dialog).get(<span class="number">0</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-241">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-241">&#182;</a>
              </div>
              <p>In our default mode hide the talk page entries</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="string">'.talkrow'</span>, dialog).addClass(<span class="string">'invisible'</span>);
        
        <span class="keyword">this</span>.updateMode();
        <span class="keyword">this</span>.updateSpacing();
    },
    
    render: <span class="keyword">function</span>(){
        <span class="keyword">return</span> <span class="keyword">this</span>.$el;
    }

});

subview = <span class="keyword">function</span>(subviewName){
    <span class="keyword">return</span> <span class="string">"&lt;div data-subview='"</span> + subviewName + <span class="string">"'&gt;&lt;/div&gt;"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-242">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-242">&#182;</a>
              </div>
              <p>From <a href="http://stackoverflow.com/questions/610406/javascript-equivalent-to-printf-string-format">http://stackoverflow.com/questions/610406/javascript-equivalent-to-printf-string-format</a>
Sort of like Python&#39;s new string formatting method. Handy when one wants to do some large string substitutions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>String.prototype.format = <span class="keyword">function</span>() {
  <span class="keyword">var</span> args = arguments;
  <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/{(\d+)}/g</span>, <span class="keyword">function</span>(match, number) { 
    <span class="keyword">return</span> <span class="keyword">typeof</span> args[number] != <span class="string">'undefined'</span>
      ? args[number]
      : match
    ;
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-243">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-243">&#182;</a>
              </div>
              <h2>Helper</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>Helper = <span class="keyword">function</span>() {};</pre></div></div>
            
        </li>
        
        
        <li id="section-244">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-244">&#182;</a>
              </div>
              <p>Takes in a javascript date object and pretty-prints it to a string which is returned.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Helper.formatDate = <span class="keyword">function</span>(dt, time) {
    <span class="keyword">if</span>(time == <span class="literal">undefined</span>) time = <span class="literal">true</span>;
    <span class="keyword">var</span> string = [<span class="string">'January'</span>, <span class="string">'February'</span>, <span class="string">'March'</span>,
        <span class="string">'April'</span>, <span class="string">'May'</span>, <span class="string">'June'</span>,
        <span class="string">'July'</span>, <span class="string">'August'</span>, <span class="string">'September'</span>,
        <span class="string">'October'</span>, <span class="string">'November'</span>, <span class="string">'December'</span>][dt.getMonth()] +
        <span class="string">' '</span> + dt.getDate() + <span class="string">', '</span> + dt.getFullYear();
    <span class="keyword">if</span>(time){</pre></div></div>
            
        </li>
        
        
        <li id="section-245">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-245">&#182;</a>
              </div>
              <p>Thanks to <a href="http://stackoverflow.com/questions/5250244/jquery-date-formatting">http://stackoverflow.com/questions/5250244/jquery-date-formatting</a>
for the quick fix for hours, minutes and seconds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        string += <span class="string">'   '</span> +
        (<span class="string">'0'</span>+dt.getHours()).substr(-<span class="number">2</span>,<span class="number">2</span>) + <span class="string">':'</span> +
        (<span class="string">'0'</span>+dt.getMinutes()).substr(-<span class="number">2</span>,<span class="number">2</span>);
    }
    <span class="keyword">return</span> string;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-246">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-246">&#182;</a>
              </div>
              <p>Build a sorting key for the sorttable library to sort the date field used in the table view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Helper.getDateSortKey = <span class="keyword">function</span>(dt) {
    <span class="keyword">return</span> String(dt.getFullYear()) + (<span class="string">'0'</span>+dt.getMonth()).substr(-<span class="number">2</span>, <span class="number">2</span>) +
        (<span class="string">'0'</span>+dt.getDate()).substr(-<span class="number">2</span>, <span class="number">2</span>) + (<span class="string">'0'</span>+dt.getHours()).substr(-<span class="number">2</span>,<span class="number">2</span>) +
        (<span class="string">'0'</span>+dt.getMinutes()).substr(-<span class="number">2</span>,<span class="number">2</span>)+(<span class="string">'0'</span>+dt.getSeconds()).substr(-<span class="number">2</span>,<span class="number">2</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-247">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-247">&#182;</a>
              </div>
              <p>Take two lists, interpret as sets, and return true if subset_l is a subset of superset_l</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Helper.isSubset = <span class="keyword">function</span>(subset_l, superset_l) {
    <span class="keyword">var</span> superset = {};
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; superset_l.length; ++i) {
        superset[superset_l[i]] = <span class="literal">true</span>;
    }
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; subset_l.length; ++i) {
        <span class="keyword">if</span> (!superset.hasOwnProperty(subset_l[i])) {
            <span class="keyword">return</span> <span class="literal">false</span>;
        }
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-248">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-248">&#182;</a>
              </div>
              <p>Generate a string describing a given article revisions&#39; edit categories</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Helper.toClassString = <span class="keyword">function</span>(rc){
    <span class="keyword">return</span> rc.split(<span class="string">';'</span>).map(<span class="keyword">function</span>(c) { <span class="keyword">return</span> ({
            <span class="string">'a'</span>: <span class="string">'edit'</span>,
            <span class="string">'b'</span>: <span class="string">'add'</span>,
            <span class="string">'c'</span>: <span class="string">'remove'</span>,
            <span class="string">'d'</span>: <span class="string">'reorganize'</span>,
            <span class="string">'e'</span>: <span class="string">'cite'</span>,
            <span class="string">'f'</span>: <span class="string">'vandalize'</span>,
            <span class="string">'g'</span>: <span class="string">'unvandalize'</span>,
            <span class="string">'x'</span>: <span class="string">'unclassified'</span>
        })[c]; }).join(<span class="string">', '</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-249">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-249">&#182;</a>
              </div>
              <p>Generate a string describing a given talk page revision entry&#39;s revision categories.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Helper.toTalkClassString = <span class="keyword">function</span>(d) {
    <span class="keyword">var</span> ret = <span class="string">""</span>;
    <span class="keyword">if</span> (d.att) ret += <span class="string">"attitude, "</span>;
    <span class="keyword">if</span> (d.crit) ret += <span class="string">"criticism, "</span>;
    <span class="keyword">if</span> (d.inf) ret += <span class="string">"informative, "</span>;
    <span class="keyword">if</span> (d.perf) ret += <span class="string">"performative, "</span>;
    <span class="keyword">return</span> ret.substring(<span class="number">0</span>,ret.length-<span class="number">2</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-250">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-250">&#182;</a>
              </div>
              <p>Return absolute max (disregarding sign) of func(arr[i])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Helper.absMax = <span class="keyword">function</span>(arr, func){
    <span class="keyword">if</span> (!(arr <span class="keyword">instanceof</span> Array) || (arr.length &lt; <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">undefined</span>;
    <span class="keyword">var</span> max = func(arr[<span class="number">0</span>]);
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; arr.length; ++i) {
        max = Math.max(max, Math.abs(func(arr[i])));
    }
    <span class="keyword">return</span> max;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-251">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-251">&#182;</a>
              </div>
              <h2>router.js</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>$.ajaxSetup({ cache: <span class="literal">false</span> });

articles = <span class="keyword">new</span> ArticleCollection();
articles.fetch();
topTabs = <span class="keyword">new</span> TopTabCollection();
topTabsView = <span class="keyword">new</span> TopTabsView({model: topTabs, el: <span class="string">"#topTabs"</span>});

PageRouter = Backbone.Router.extend({
    routes: {
        <span class="string">"test"</span>: <span class="string">"testRoute"</span>,
        <span class="string">"*actions"</span>: <span class="string">"defaultRoute"</span>
    },
    
    defaultRoute: <span class="keyword">function</span>(actions){
        <span class="keyword">var</span> newArticleView = <span class="keyword">new</span> NewArticleView({model: articles});
        topTabsView.render();
        topTabs.add(<span class="keyword">new</span> TopTab({title: <span class="string">"New Tab"</span>, mainView: newArticleView, selected: <span class="literal">true</span>}));
        topTabs.add(<span class="keyword">new</span> NewTopTab());
    }
    
});</pre></div></div>
            
        </li>
        
        
        <li id="section-252">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-252">&#182;</a>
              </div>
              <p>Initiate the router</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>pageRouter = <span class="keyword">new</span> PageRouter();</pre></div></div>
            
        </li>
        
        
        <li id="section-253">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-253">&#182;</a>
              </div>
              <p>Start Backbone history a necessary step for bookmarkable URL&#39;s</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.history.start();

})(window,document);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
